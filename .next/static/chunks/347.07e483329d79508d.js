"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[347],{2347:function(e,t,a){let s,n;a.r(t),a.d(t,{Command:function(){return C},PalletEngine:function(){return E},Renderer:function(){return M},Scene:function(){return P},_module:function(){return n}});var i,r,o,l,d=a(6376),h=a(2085),c=a(2111),u=a(6967),p=a(4782),m=a(7610),w=a(647),g=a(9462),x=a(9807),b=a(2675),f=a(3898);let G=new d.FM8;function v(e,t){return e.parent instanceof t?e.parent:null!==e.parent?v(e.parent,t):null}console.log("Pallet v.".concat(0,".").concat(1,".").concat(0)),d.u9r.prototype.computeBoundsTree=m.Xy,d.u9r.prototype.disposeBoundsTree=m.sn,d.Kj0.prototype.raycast=m.uL,(i=o||(o={})).HighPerformance="high-performance",i.LowPower="low-power",i.Default="default",(r=l||(l={}))[r.Left=0]="Left",r[r.Wheel=1]="Wheel",r[r.Right=2]="Right";class C{constructor(){}}class y{drawHelper(){}connectEvent(){}getViewportPos(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return G.x=e/window.innerWidth*2-1,G.y=-(t/window.innerHeight*2)+1,a&&a.copy(G),G}constructor(e){this.raycaster=new d.iMs,this.raycaster.params.Line.threshold=0}}class B extends y{drawGhost(){}connectEvent(){document.addEventListener("mousedown",e=>{this.cursorStart.set(e.clientX,e.clientY),this.shiftPressed?(n.controller.enabled=!1,this.selectionHelper.enabled=!0,this.selectionHelper.element.classList.remove("disabled"),this.selectionBox.startPoint.set(e.clientX/window.innerWidth*2-1,-(e.clientY/window.innerHeight*2)+1,.5)):this.selectionHelper.enabled=!1}),document.addEventListener("mousemove",e=>{this.shiftPressed&&this.selectionBox.endPoint.set(e.clientX/window.innerWidth*2-1,-(e.clientY/window.innerHeight*2)+1,.5)}),document.addEventListener("mouseup",e=>{this.cursorEnd.set(e.clientX,e.clientY);let t=e.target===M.Canvas(),a={drag:this.cursorStart.distanceTo(this.cursorEnd)>.01,canvasEvent:t};if(n.controller.enabled=!0,this.selectionHelper.element.classList.add("disabled"),this.disableContextGUI(),this.shiftPressed)this.selectionBox.endPoint.set(e.clientX/window.innerWidth*2-1,-(e.clientY/window.innerHeight*2)+1,.5),this.selectionBox.select(),console.log(this.selectionBox.collection.filter(e=>{let t=v(e,p.JW),a=e.isTransformControlsPlane,s=e.isGround,n=e.isLine||e.isLineSegment;return!t&&!s&&!n&&!a}));else switch(e.button){case 0:this.onLeftClick(this.cursorEnd,a);break;case 2:this.onRightClick(this.cursorEnd,a);break;case 1:this.onWheelClick(this.cursorEnd,a)}}),document.addEventListener("keydown",e=>{switch(e.code){case"ControlLeft":case"AltLeft":case"Tab":break;case"ShiftLeft":this.shiftPressed=!0;break;case"KeyQ":console.log(this.controls.space),this.controls.setSpace("local"===this.controls.space?"world":"local");break;case"KeyW":this.controls.setMode("translate");break;case"KeyE":this.controls.setMode("rotate");break;case"KeyR":this.controls.setMode("scale")}}),document.addEventListener("keyup",e=>{switch(e.code){case"ControlLeft":case"AltLeft":case"Tab":break;case"ShiftLeft":this.shiftPressed=!1}})}disconnectEvent(e){}onLeftClick(e,t){if(this.controls.axis||t.drag||!t.canvasEvent)return;this.raycaster.setFromCamera(this.getViewportPos(e.x,e.y),n.camera);let a=this.raycaster.intersectObject(n.sceneGraph);this.onIntersection(a)}onRightClick(e,t){this.raycaster.setFromCamera(this.getViewportPos(e.x,e.y),n.camera);let a=this.raycaster.intersectObject(n.sceneGraph);!1==t.drag&&this.onContext(a,e)}onWheelClick(e,t){}onDragging(e){}onContext(e,t){let a=e.filter(e=>e.object.isMesh&&!v(e.object,p.Ys));if(a.length>0){console.log(a);let e=v(a[0].object,d.ZAu);a[0].object.isGround?this.enableContextGUI(t,"add"):this.enableContextGUI(t,"property"),e?this.context=e:this.context=a[0].object,this.hitPoint.copy(a[0].point)}else this.context=null,this.disableContextGUI()}onIntersection(e){this.replaceButtonImage(void 0);let t=e.filter(e=>e.object.isMesh&&!v(e.object,p.Ys));if(console.log(t),t.length>0&&!t[0].object.isGround){this.controls.enabled=!0;let e=v(t[0].object,d.ZAu);if(this.targetMaterial=null,e)this.controls.attach(e),this.context=e;else{let e=t[0].object;this.controls.attach(e),this.context=t[0].object,this.replaceButtonImage(void 0),e.isMesh&&e.material&&e.material.map&&(function(e){let t=x.P.getDataURL(e);console.log(this),this.replaceButtonImage(t)}).bind(this)(e.material.map.image)}}else this.controls.detach(),this.controls.enabled=!1,this.controls.setMode("translate"),this.context=null}createControls(e,t){return this.controls=new p.Ys(e,t),this.controls}enableContextGUI(e,t){this.contextGUI.style.visibility="visible",e&&(this.contextGUI.style.left="".concat(e.x,"px"),this.contextGUI.style.top="".concat(e.y,"px")),n.contextGUI.children.forEach(e=>{e._title.toLowerCase()==t?e.show():e.hide()})}disableContextGUI(){this.contextGUI.style.visibility="hidden"}replaceButtonImage(e){if(this.textureButton&&this.textureButton.domElement){let t=this.textureButton.domElement.children[0].children.length>1?this.textureButton.domElement.children[0].children[1]:this.textureButton.domElement.children[0].children[0];t&&(t.style.backgroundImage='url("'.concat(e,'")'),t.style.backgroundSize="cover",t.style.backgroundRepeat="no-repeat",t.style.backgroundPosition="center",t.style.width="100px",t.style.height="100px",t.style.marginLeft="auto",t.textContent="")}}replaceTexture(e){this.targetMaterial?(this.targetMaterial.map=e,this.targetMaterial.needsUpdate=!0):this.context&&(this.context.material.map=e,this.context.material.needsUpdate=!0)}constructor(){super({}),this.hitPoint=new d.Pa4,this.selectionBox=new w.M,this.selectionHelper=new g.Q(M.Get(),"selectBox"),this.selectionHelper.element.classList.add("disabled"),this.shiftPressed=!1,this.materialFolder=void 0,this.textureButton=void 0,this.targetMaterial=null,this.cursorStart=new d.FM8,this.cursorEnd=new d.FM8}}class L{isEmpty(){return this.array.length>0}update(){this.isEmpty()}constructor(){this.array=[]}}class P{defaultScene(){}constructor(){this.root=new d.xsS,this.animationObjects=new d.ZAu}}class M{static Get(){return M.renderer||M.Create({}),M.renderer}static Canvas(){return M.renderer?M.renderer.domElement:null}static Create(e){return M.renderer=new d.CP7(e),M.renderer}static AnimationLoop(e){}}M.composer=null,M.renderer=null,M.canvas=null,M.option={alpha:!0};class I extends HTMLElement{constructor(){super()}}class U{static FileSelector(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.createElement("input");return t.setAttribute("type","file"),t.setAttribute("multiple","".concat(e)),t.click(),t}static FileExtension(e){}constructor(){}}class E extends I{createGUI(){this.screenGUI.addFolder("System").add({Add:function(){},Import:function(){let e=U.FileSelector();e.addEventListener("change",()=>{let t=URL.createObjectURL(e.files[0]);n.gltfLoader.load(t,e=>{n.sceneGraph.add(e.scene)})})}},"Import");let e=this.screenGUI.addFolder("Transform");e.close();let t=e.addFolder("Position");t.close();let a={X:0,Y:0,Z:0},s=e=>{w.context&&w.context.position.set(a.X,a.Y,a.Z)};t.add(a,"X").listen().onChange(s),t.add(a,"Y").listen().onChange(s),t.add(a,"Z").listen().onChange(s);let i=e.addFolder("Rotation");i.close();let r={X:0,Y:0,Z:0},o=e=>{w.context&&w.context.rotation.set(r.X,r.Y,r.Z)};i.add(r,"X").listen().onChange(o),i.add(r,"Y").listen().onChange(o),i.add(r,"Z").listen().onChange(o);let l=e.addFolder("Scale");l.close();let h={X:1,Y:1,Z:1},c=e=>{w.context&&w.context.scale.set(h.X,h.Y,h.Z)};l.add(h,"X").listen().onChange(c),l.add(h,"Y").listen().onChange(c),l.add(h,"Z").listen().onChange(c);let u=this.screenGUI.addFolder("Material"),p={Color:16777215,Map:()=>{let e=document.createElement("input");e.type="file",e.style.display="none",e.onchange=t=>{t.preventDefault(),t.stopPropagation();let a=new FileReader;a.onload=e=>{new d.dpR().load(e.target.result,e=>{console.log(w.context),w.replaceTexture(e)}),w.replaceButtonImage(e.target.result)},a.readAsDataURL(e.files[0])},e.click()},NormalMap:()=>{},SpecularMap:()=>{}};u.addColor(p,"Color").listen().onChange(e=>{w.targetMaterial?w.targetMaterial.color.setHex(e):w.context&&w.context.isMesh&&w.context.material.color&&w.context.material.color.setHex(e)});let m=u.add(p,"Map"),w=this.irc;w.textureButton=m,w.replaceButtonImage(void 0);let g=w.textureButton.domElement.children[0].children[0],b=document.createElement("div");b.textContent="Map",g.parentElement.insertBefore(b,g);let f=this.screenGUI.addFolder("Meshes"),G=this.screenGUI.addFolder("Etc"),v={Animation:!0,Loop:!0,Reset:()=>{w.context.userData.action.time=0},Updator:!0},C=G.add(v,"Animation").listen().onChange(e=>{e?w.context.userData.action.paused=!1:w.context.userData.action.paused=!0}),y=G.add(v,"Loop").listen().onChange(e=>{e?(w.context.userData.action.setLoop(d.YKA,1/0),w.context.userData.action.reset()):w.context.userData.action.setLoop(d.jAl)}),B=G.add(v,"Reset"),L=G.add(v,"Updator").listen().onChange(e=>{w.context.userData.updator.enabled=e}),P="",M=e=>{let t=e.controllers.length,a=e.controllers;e.children=[],e.controllers=[];for(let e=0;e<t;++e)a[e].hide(),a[e].destroy()};this.addUpdator(e=>{let t=w.context;if(t){if(a.X=t.position.x,a.Y=t.position.y,a.Z=t.position.z,r.X=t.rotation.x,r.Y=t.rotation.y,r.Z=t.rotation.z,h.X=t.scale.x,h.Y=t.scale.y,h.Z=t.scale.z,t.userData.mixer?(C.enable(),y.enable(),B.enable(),t.userData.action.paused&&y.setValue(t.userData.action.paused===d.YKA),t.userData.action.loop===d.YKA?y.setValue(!0):y.setValue(!1)):(C.disable(),y.disable(),B.disable()),t.userData.updator?(L.enable(),L.setValue(t.userData.updator.enabled)):L.disable(),t.isMesh&&t.material&&(t.material.color?p.Color=t.material.color.getHex():p.Color=16777215),t.uuid===P);else{P=t.uuid;let e={};M(f),t.isGroup&&t.traverse(t=>{t.isMesh&&(e[t.name]=()=>{t.material.map&&(function(e){let a=x.P.getDataURL(e);w.targetMaterial=t.material,p.Color=t.material.color.getHexString(),w.replaceButtonImage(a)}).bind(this)(t.material.map.image)},f.add(e,"".concat(t.name)))})}}else a.X=0,a.Y=0,a.Z=0,r.X=0,r.Y=0,r.Z=0,h.X=1,h.Y=1,h.Z=1,p.Color=16777215,M(f),C.disable(),y.disable(),B.disable(),L.disable(),P=""}),this.contextGUIOuter.style.cssText="position: absolute; left: 0px; top: 0px; visibility: hidden;",this.contextGUI.addFolder("Property").hide();let I={Box:()=>{w.disableContextGUI();let e=new d.DvJ(1,1,1),t=new d.vBJ,a=new d.Kj0(e,t);a.position.copy(w.hitPoint),this.sceneGraph.add(a)},Sphere:()=>{w.disableContextGUI();let e=new d.xo$(.8,30,15),t=new d.vBJ,a=new d.Kj0(e,t);a.position.copy(w.hitPoint),this.sceneGraph.add(a)},Plane:()=>{w.disableContextGUI();let e=new d._12(1,1,1),t=new d.vBJ,a=new d.Kj0(e,t);a.position.copy(w.hitPoint),this.sceneGraph.add(a)},GLB:()=>{w.disableContextGUI()}},E=this.contextGUI.addFolder("Add");E.add(I,"Box"),E.add(I,"Sphere"),E.add(I,"Plane"),E.add(I,"GLB"),console.log(this.contextGUI)}createScene(){let e=new d.VLJ(50,50,8158332,6250335),t=new d.Kj0(new d._12(50,50,10,10),new d.vBJ({transparent:!0,opacity:.1,color:5726326}));t.name="GridPlane",t.isGround=!0,t.castShadow=!0,t.rotation.set(-1.57,0,0),this.camera.position.set(0,5,5),this.sceneGraph.add(e),this.sceneGraph.add(t),this.sceneGraph.userData.gridPlane=t,this.sceneGraph.userData.gridHelper=e,this.directionalLight=new d.Ox3(16777215,10),this.directionalLight.shadow.camera.right=25,this.directionalLight.shadow.camera.left=-25,this.directionalLight.shadow.camera.top=25,this.directionalLight.shadow.camera.bottom=-25,this.directionalLight.shadow.camera.far=10,this.directionalLight.shadow.camera.near=-50,this.directionalLight.shadow.camera.width=1024,this.directionalLight.shadow.camera.height=1024,this.sceneGraph.add(this.directionalLight),this.ambientLight=new d.Mig(16775400),this.sceneGraph.add(this.ambientLight),this.directionalLight.castShadow=!0;let a=new d.Kj0(new d.DvJ(1,1,1),new d.Wid({color:16768954}));this.sceneGraph.add(a),(s=a).receiveShadow=!0,s.castShadow=!0,s.userData.updator=this.addUpdator(e=>{a.rotation.x+=.01,a.rotation.y+=.01});let n=new d.Kj0(new d.DvJ(1,1,1),new d.Wid({color:16768954}));this.sceneGraph.add(n),n.receiveShadow=!0,n.castShadow=!0,n.position.set(1,1,.5),n.userData.updator=this.addUpdator(e=>{n.rotation.x+=.01,n.rotation.z+=.01})}clearScene(){}createEnvironment(){}loadGLTF(e,t){this.gltfLoader.load(e,e=>{t(e),this.sceneGraph.add(e.scene)})}update(e){this.updateFunctions.map(t=>{t.enabled&&t.func(e)}),this.commandQueue.update(),this.controller.update();let t=this.sceneGraph.background;this.sceneGraph.background=null,this.shadowCameraHelper.visible=!1,this.sceneGraph.userData.gridPlane.visible=!1,this.sceneGraph.userData.gridHelper.visible=!1,this.sceneGraph.overrideMaterial=this.depthMaterial;let a=!1,s=this.irc.controls;this.irc&&(a=s.visible,s.visible=!1);let n=M.Get().getClearAlpha();M.Get().setClearAlpha(0),M.Get().setRenderTarget(this.renderTarget),M.Get().render(this.sceneGraph,this.shadowCamera),this.sceneGraph.overrideMaterial=null,this.sceneGraph.userData.gridPlane.visible=!0,this.sceneGraph.userData.gridHelper.visible=!0,s.visible=a,this.blurShadow(this.shaderState.shadow.blur),this.blurShadow(.4*this.shaderState.shadow.blur),M.Get().setRenderTarget(null),M.Get().setClearAlpha(n),this.sceneGraph.background=t,M.Get().render(this.sceneGraph,this.camera)}addUpdator(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],a={func:e,enabled:t};return this.updateFunctions.push(a),a}appendCommand(){}blurShadow(e){this.shadowBlurPlane.visible=!0,this.shadowBlurPlane.material=this.horizontalBlurMaterial,this.shadowBlurPlane.material.uniforms.tDiffuse.value=this.renderTarget.texture,this.horizontalBlurMaterial.uniforms.h.value=1*e/256,M.Get().setRenderTarget(this.renderTargetBlur),M.Get().render(this.shadowBlurPlane,this.shadowCamera),this.shadowBlurPlane.material=this.verticalBlurMaterial,this.shadowBlurPlane.material.uniforms.tDiffuse.value=this.renderTargetBlur.texture,this.verticalBlurMaterial.uniforms.v.value=1*e/256,M.Get().setRenderTarget(this.renderTarget),M.Get().render(this.shadowBlurPlane,this.shadowCamera),this.shadowBlurPlane.visible=!1}constructor(e){super(),this.verticalBlurMaterial=d.jyz,this.sceneGraph=new d.xsS,this.camera=new d.cPb(75,window.innerWidth/window.innerHeight,.1,1e3),this.gltfLoader=new c.E,this.clock=new d.SUY,this.controller=new u.z(this.camera,e),this.controller.enableDamping=!0,this.controller.dampingFactor=.1,this.updateFunctions=[],this.commandQueue=new L;let t=M.Create({antialias:!0,canvas:e});t.setSize(window.innerWidth,window.innerHeight),t.setClearColor(3947580),t.shadowMap.enabled=!0,t.shadowMap.type=d.ntZ,t.setAnimationLoop(()=>{let e=this.clock.getDelta();this.update(e)}),window.addEventListener("resize",e=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),t.setSize(window.innerWidth,window.innerHeight)}),this.irc=new B,this.irc.connectEvent(),this.screenGUI=new h.ZP({title:"Properties"}),this.screenGUI.close(),this.contextGUIOuter=document.createElement("div"),this.contextGUIOuter.addEventListener("mouseup",e=>e.stopPropagation());let a=this.irc;a.contextGUI=this.contextGUIOuter,document.body.appendChild(this.contextGUIOuter),this.contextGUI=new h.ZP({container:this.contextGUIOuter,title:"Context"});let s=a.createControls(this.camera,e);this.sceneGraph.add(s),s.addEventListener("dragging-changed",e=>{this.controller.enabled=!e.value}),a.selectionBox.camera=this.camera,a.selectionBox.scene=this.sceneGraph,window.addEventListener("contextmenu",e=>e.preventDefault()),this.shaderState={shadow:{blur:.2,darkness:5,opacity:1},plane:{color:"#ffffff",opacity:1},showWireframe:!1},this.shadowGroup=new d.ZAu,this.sceneGraph.add(this.shadowGroup),this.renderTarget=new d.dd2(1024,1024),this.renderTarget.generateMipmaps=!1,this.renderTargetBlur=new d.dd2(1024,1024),this.renderTargetBlur.generateMipmaps=!1;let n=new d._12(50,50).rotateX(Math.PI/2),i=new d.vBJ({map:this.renderTarget.texture,opacity:1,transparent:!0,depthWrite:!1});this.shadowPlane=new d.Kj0(n,i),this.shadowPlane.scale.y=-1,this.shadowPlane.position.set(0,.1,0),this.shadowPlane.renderOrder=1,this.shadowGroup.add(this.shadowPlane),this.shadowBlurPlane=new d.Kj0(n),this.shadowBlurPlane.visible=!1,this.shadowGroup.add(this.shadowBlurPlane),this.shadowCamera=new d.iKG(-25,25,25,-25,0,10),this.shadowCamera.rotation.x=Math.PI/2,this.shadowGroup.add(this.shadowCamera),this.shadowCameraHelper=new d.Rki(this.shadowCamera),this.shadowGroup.add(this.shadowCameraHelper),this.depthMaterial=new d.lRF,this.depthMaterial.userData.darkness={value:this.shaderState.shadow.darkness},this.depthMaterial.onBeforeCompile=(function(e){e.uniforms.darkness=this.depthMaterial.userData.darkness,e.fragmentShader="\n                uniform float darkness;\n                ".concat(e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );"),"\n            ")}).bind(this),this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1,this.horizontalBlurMaterial=new d.jyz(b.P),this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial=new d.jyz(f.Z),this.verticalBlurMaterial.depthTest=!1,this.createScene(),this.createGUI()}}customElements.define("pallet-element",I),customElements.define("pallet-engine",E);let S=document.getElementsByTagName("canvas");S.length>0&&(n=new E(S[0]))}}]);
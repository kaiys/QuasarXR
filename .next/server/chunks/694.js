"use strict";exports.id=694,exports.ids=[694],exports.modules={1694:(e,t,i)=>{let n,s,r,o,a,l,h,c,d;i.r(t),i.d(t,{Command:()=>ni,PalletEngine:()=>nc,Renderer:()=>na,Scene:()=>no,_module:()=>d});var u,p,m=i(6955);/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.19.2
 * @author George Michael Brower
 * @license MIT
 */class f{constructor(e,t,i,n,s="div"){this.parent=e,this.object=t,this.property=i,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement(s),this.domElement.classList.add("controller"),this.domElement.classList.add(n),this.$name=document.createElement("div"),this.$name.classList.add("name"),f.nextNameID=f.nextNameID||0,this.$name.id=`lil-gui-name-${++f.nextNameID}`,this.$widget=document.createElement("div"),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.domElement.addEventListener("keydown",e=>e.stopPropagation()),this.domElement.addEventListener("keyup",e=>e.stopPropagation()),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(i)}name(e){return this._name=e,this.$name.textContent=e,this}onChange(e){return this._onChange=e,this}_callOnChange(){this.parent._callOnChange(this),void 0!==this._onChange&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),void 0!==this._onFinishChange&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(e=!0){return this.disable(!e)}disable(e=!0){return e===this._disabled||(this._disabled=e,this.domElement.classList.toggle("disabled",e),this.$disable.toggleAttribute("disabled",e)),this}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(e){let t=this.parent.add(this.object,this.property,e);return t.name(this._name),this.destroy(),t}min(e){return this}max(e){return this}step(e){return this}decimals(e){return this}listen(e=!0){return this._listening=e,void 0!==this._listenCallbackID&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);let e=this.save();e!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=e}getValue(){return this.object[this.property]}setValue(e){return this.getValue()!==e&&(this.object[this.property]=e,this._callOnChange(),this.updateDisplay()),this}updateDisplay(){return this}load(e){return this.setValue(e),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class g extends f{constructor(e,t,i){super(e,t,i,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function y(e){let t,i;return(t=e.match(/(#|0x)?([a-f0-9]{6})/i))?i=t[2]:(t=e.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?i=parseInt(t[1]).toString(16).padStart(2,0)+parseInt(t[2]).toString(16).padStart(2,0)+parseInt(t[3]).toString(16).padStart(2,0):(t=e.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(i=t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),!!i&&"#"+i}let w={isPrimitive:!0,match:e=>"number"==typeof e,fromHexString:e=>parseInt(e.substring(1),16),toHexString:e=>"#"+e.toString(16).padStart(6,0)},x=[{isPrimitive:!0,match:e=>"string"==typeof e,fromHexString:y,toHexString:y},w,{isPrimitive:!1,match:e=>Array.isArray(e),fromHexString(e,t,i=1){let n=w.fromHexString(e);t[0]=(n>>16&255)/255*i,t[1]=(n>>8&255)/255*i,t[2]=(255&n)/255*i},toHexString([e,t,i],n=1){let s=e*(n=255/n)<<16^t*n<<8^i*n<<0;return w.toHexString(s)}},{isPrimitive:!1,match:e=>Object(e)===e,fromHexString(e,t,i=1){let n=w.fromHexString(e);t.r=(n>>16&255)/255*i,t.g=(n>>8&255)/255*i,t.b=(255&n)/255*i},toHexString({r:e,g:t,b:i},n=1){let s=e*(n=255/n)<<16^t*n<<8^i*n<<0;return w.toHexString(s)}}];class v extends f{constructor(e,t,i,n){var s;super(e,t,i,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(s=this.initialValue,x.find(e=>e.match(s))),this._rgbScale=n,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{let e=y(this.$text.value);e&&this._setValueFromHexString(e)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(e){if(this._format.isPrimitive){let t=this._format.fromHexString(e);this.setValue(t)}else this._format.fromHexString(e,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(e){return this._setValueFromHexString(e),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class b extends f{constructor(e,t,i){super(e,t,i,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",e=>{e.preventDefault(),this.getValue().call(this.object),this._callOnChange()}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class A extends f{constructor(e,t,i,n,s,r){super(e,t,i,"number"),this._initInput(),this.min(n),this.max(s);let o=void 0!==r;this.step(o?r:this._getImplicitStep(),o),this.updateDisplay()}decimals(e){return this._decimals=e,this.updateDisplay(),this}min(e){return this._min=e,this._onUpdateMinMax(),this}max(e){return this._max=e,this._onUpdateMinMax(),this}step(e,t=!0){return this._step=e,this._stepExplicit=t,this}updateDisplay(){let e=this.getValue();if(this._hasSlider){let t=(e-this._min)/(this._max-this._min);t=Math.max(0,Math.min(t,1)),this.$fill.style.width=100*t+"%"}return this._inputFocused||(this.$input.value=void 0===this._decimals?e:e.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),window.matchMedia("(pointer: coarse)").matches&&(this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any")),this.$widget.appendChild(this.$input),this.$disable=this.$input;let e=e=>{let t=parseFloat(this.$input.value);isNaN(t)||(this._snapClampSetValue(t+e),this.$input.value=this.getValue())},t=!1,i,n,s,r,o,a=e=>{if(t){let s=e.clientX-i;Math.abs(e.clientY-n)>5?(e.preventDefault(),this.$input.blur(),t=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(s)>5&&l()}if(!t){let t=e.clientY-s;o-=t*this._step*this._arrowKeyMultiplier(e),r+o>this._max?o=this._max-r:r+o<this._min&&(o=this._min-r),this._snapClampSetValue(r+o)}s=e.clientY},l=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",l)};this.$input.addEventListener("input",()=>{let e=parseFloat(this.$input.value);isNaN(e)||(this._stepExplicit&&(e=this._snap(e)),this.setValue(this._clamp(e)))}),this.$input.addEventListener("keydown",t=>{"Enter"===t.key&&this.$input.blur(),"ArrowUp"===t.code&&(t.preventDefault(),e(this._step*this._arrowKeyMultiplier(t))),"ArrowDown"===t.code&&(t.preventDefault(),e(-(this._step*this._arrowKeyMultiplier(t)*1)))}),this.$input.addEventListener("wheel",t=>{this._inputFocused&&(t.preventDefault(),e(this._step*this._normalizeMouseWheel(t)))},{passive:!1}),this.$input.addEventListener("mousedown",e=>{i=e.clientX,n=s=e.clientY,t=!0,r=this.getValue(),o=0,window.addEventListener("mousemove",a),window.addEventListener("mouseup",l)}),this.$input.addEventListener("focus",()=>{this._inputFocused=!0}),this.$input.addEventListener("blur",()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()})}_initSlider(){let e;this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");let t=(e,t,i,n,s)=>(e-t)/(i-t)*(s-n)+n,i=e=>{let i=this.$slider.getBoundingClientRect(),n=t(e,i.left,i.right,this._min,this._max);this._snapClampSetValue(n)},n=e=>{i(e.clientX)},s=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",s)},r=!1,o,a,l=e=>{e.preventDefault(),this._setDraggingStyle(!0),i(e.touches[0].clientX),r=!1},h=e=>{r?Math.abs(e.touches[0].clientX-o)>Math.abs(e.touches[0].clientY-a)?l(e):(window.removeEventListener("touchmove",h),window.removeEventListener("touchend",c)):(e.preventDefault(),i(e.touches[0].clientX))},c=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",h),window.removeEventListener("touchend",c)},d=this._callOnFinishChange.bind(this);this.$slider.addEventListener("mousedown",e=>{this._setDraggingStyle(!0),i(e.clientX),window.addEventListener("mousemove",n),window.addEventListener("mouseup",s)}),this.$slider.addEventListener("touchstart",e=>{e.touches.length>1||(this._hasScrollBar?(o=e.touches[0].clientX,a=e.touches[0].clientY,r=!0):l(e),window.addEventListener("touchmove",h,{passive:!1}),window.addEventListener("touchend",c))},{passive:!1}),this.$slider.addEventListener("wheel",t=>{if(Math.abs(t.deltaX)<Math.abs(t.deltaY)&&this._hasScrollBar)return;t.preventDefault();let i=this._normalizeMouseWheel(t)*this._step;this._snapClampSetValue(this.getValue()+i),this.$input.value=this.getValue(),clearTimeout(e),e=setTimeout(d,400)},{passive:!1})}_setDraggingStyle(e,t="horizontal"){this.$slider&&this.$slider.classList.toggle("active",e),document.body.classList.toggle("lil-gui-dragging",e),document.body.classList.toggle(`lil-gui-${t}`,e)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(e){let{deltaX:t,deltaY:i}=e;return Math.floor(e.deltaY)!==e.deltaY&&e.wheelDelta&&(t=0,i=-e.wheelDelta/120*(this._stepExplicit?1:10)),t+-i}_arrowKeyMultiplier(e){let t=this._stepExplicit?1:10;return e.shiftKey?t*=10:e.altKey&&(t/=10),t}_snap(e){return parseFloat((Math.round(e/this._step)*this._step).toPrecision(15))}_clamp(e){return e<this._min&&(e=this._min),e>this._max&&(e=this._max),e}_snapClampSetValue(e){this.setValue(this._clamp(this._snap(e)))}get _hasScrollBar(){let e=this.parent.root.$children;return e.scrollHeight>e.clientHeight}get _hasMin(){return void 0!==this._min}get _hasMax(){return void 0!==this._max}}class E extends f{constructor(e,t,i,n){super(e,t,i,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.options(n)}options(e){return this._values=Array.isArray(e)?e:Object.values(e),this._names=Array.isArray(e)?e:Object.keys(e),this.$select.replaceChildren(),this._names.forEach(e=>{let t=document.createElement("option");t.textContent=e,this.$select.appendChild(t)}),this.updateDisplay(),this}updateDisplay(){let e=this.getValue(),t=this._values.indexOf(e);return this.$select.selectedIndex=t,this.$display.textContent=-1===t?e:this._names[t],this}}class P extends f{constructor(e,t,i){super(e,t,i,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("spellcheck","false"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",e=>{"Enter"===e.code&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let T=`.lil-gui {
  font-family: var(--font-family);
  font-size: var(--font-size);
  line-height: 1;
  font-weight: normal;
  font-style: normal;
  text-align: left;
  color: var(--text-color);
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  --background-color: #1f1f1f;
  --text-color: #ebebeb;
  --title-background-color: #111111;
  --title-text-color: #ebebeb;
  --widget-color: #424242;
  --hover-color: #4f4f4f;
  --focus-color: #595959;
  --number-color: #2cc9ff;
  --string-color: #a2db3c;
  --font-size: 11px;
  --input-font-size: 11px;
  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;
  --padding: 4px;
  --spacing: 4px;
  --widget-height: 20px;
  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);
  --name-width: 45%;
  --slider-knob-width: 2px;
  --slider-input-width: 27%;
  --color-input-width: 27%;
  --slider-input-min-width: 45px;
  --color-input-min-width: 45px;
  --folder-indent: 7px;
  --widget-padding: 0 0 0 3px;
  --widget-border-radius: 2px;
  --checkbox-size: calc(0.75 * var(--widget-height));
  --scrollbar-width: 5px;
}
.lil-gui, .lil-gui * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
.lil-gui.root {
  width: var(--width, 245px);
  display: flex;
  flex-direction: column;
  background: var(--background-color);
}
.lil-gui.root > .title {
  background: var(--title-background-color);
  color: var(--title-text-color);
}
.lil-gui.root > .children {
  overflow-x: hidden;
  overflow-y: auto;
}
.lil-gui.root > .children::-webkit-scrollbar {
  width: var(--scrollbar-width);
  height: var(--scrollbar-width);
  background: var(--background-color);
}
.lil-gui.root > .children::-webkit-scrollbar-thumb {
  border-radius: var(--scrollbar-width);
  background: var(--focus-color);
}
@media (pointer: coarse) {
  .lil-gui.allow-touch-styles, .lil-gui.allow-touch-styles .lil-gui {
    --widget-height: 28px;
    --padding: 6px;
    --spacing: 6px;
    --font-size: 13px;
    --input-font-size: 16px;
    --folder-indent: 10px;
    --scrollbar-width: 7px;
    --slider-input-min-width: 50px;
    --color-input-min-width: 65px;
  }
}
.lil-gui.force-touch-styles, .lil-gui.force-touch-styles .lil-gui {
  --widget-height: 28px;
  --padding: 6px;
  --spacing: 6px;
  --font-size: 13px;
  --input-font-size: 16px;
  --folder-indent: 10px;
  --scrollbar-width: 7px;
  --slider-input-min-width: 50px;
  --color-input-min-width: 65px;
}
.lil-gui.autoPlace {
  max-height: 100%;
  position: fixed;
  top: 0;
  right: 15px;
  z-index: 1001;
}

.lil-gui .controller {
  display: flex;
  align-items: center;
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
}
.lil-gui .controller.disabled {
  opacity: 0.5;
}
.lil-gui .controller.disabled, .lil-gui .controller.disabled * {
  pointer-events: none !important;
}
.lil-gui .controller > .name {
  min-width: var(--name-width);
  flex-shrink: 0;
  white-space: pre;
  padding-right: var(--spacing);
  line-height: var(--widget-height);
}
.lil-gui .controller .widget {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  min-height: var(--widget-height);
}
.lil-gui .controller.string input {
  color: var(--string-color);
}
.lil-gui .controller.boolean {
  cursor: pointer;
}
.lil-gui .controller.color .display {
  width: 100%;
  height: var(--widget-height);
  border-radius: var(--widget-border-radius);
  position: relative;
}
@media (hover: hover) {
  .lil-gui .controller.color .display:hover:before {
    content: " ";
    display: block;
    position: absolute;
    border-radius: var(--widget-border-radius);
    border: 1px solid #fff9;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
.lil-gui .controller.color input[type=color] {
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
.lil-gui .controller.color input[type=text] {
  margin-left: var(--spacing);
  font-family: var(--font-family-mono);
  min-width: var(--color-input-min-width);
  width: var(--color-input-width);
  flex-shrink: 0;
}
.lil-gui .controller.option select {
  opacity: 0;
  position: absolute;
  width: 100%;
  max-width: 100%;
}
.lil-gui .controller.option .display {
  position: relative;
  pointer-events: none;
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  line-height: var(--widget-height);
  max-width: 100%;
  overflow: hidden;
  word-break: break-all;
  padding-left: 0.55em;
  padding-right: 1.75em;
  background: var(--widget-color);
}
@media (hover: hover) {
  .lil-gui .controller.option .display.focus {
    background: var(--focus-color);
  }
}
.lil-gui .controller.option .display.active {
  background: var(--focus-color);
}
.lil-gui .controller.option .display:after {
  font-family: "lil-gui";
  content: "↕";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  padding-right: 0.375em;
}
.lil-gui .controller.option .widget,
.lil-gui .controller.option select {
  cursor: pointer;
}
@media (hover: hover) {
  .lil-gui .controller.option .widget:hover .display {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number input {
  color: var(--number-color);
}
.lil-gui .controller.number.hasSlider input {
  margin-left: var(--spacing);
  width: var(--slider-input-width);
  min-width: var(--slider-input-min-width);
  flex-shrink: 0;
}
.lil-gui .controller.number .slider {
  width: 100%;
  height: var(--widget-height);
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
  padding-right: var(--slider-knob-width);
  overflow: hidden;
  cursor: ew-resize;
  touch-action: pan-y;
}
@media (hover: hover) {
  .lil-gui .controller.number .slider:hover {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number .slider.active {
  background: var(--focus-color);
}
.lil-gui .controller.number .slider.active .fill {
  opacity: 0.95;
}
.lil-gui .controller.number .fill {
  height: 100%;
  border-right: var(--slider-knob-width) solid var(--number-color);
  box-sizing: content-box;
}

.lil-gui-dragging .lil-gui {
  --hover-color: var(--widget-color);
}
.lil-gui-dragging * {
  cursor: ew-resize !important;
}

.lil-gui-dragging.lil-gui-vertical * {
  cursor: ns-resize !important;
}

.lil-gui .title {
  height: var(--title-height);
  line-height: calc(var(--title-height) - 4px);
  font-weight: 600;
  padding: 0 var(--padding);
  -webkit-tap-highlight-color: transparent;
  cursor: pointer;
  outline: none;
  text-decoration-skip: objects;
}
.lil-gui .title:before {
  font-family: "lil-gui";
  content: "▾";
  padding-right: 2px;
  display: inline-block;
}
.lil-gui .title:active {
  background: var(--title-background-color);
  opacity: 0.75;
}
@media (hover: hover) {
  body:not(.lil-gui-dragging) .lil-gui .title:hover {
    background: var(--title-background-color);
    opacity: 0.85;
  }
  .lil-gui .title:focus {
    text-decoration: underline var(--focus-color);
  }
}
.lil-gui.root > .title:focus {
  text-decoration: none !important;
}
.lil-gui.closed > .title:before {
  content: "▸";
}
.lil-gui.closed > .children {
  transform: translateY(-7px);
  opacity: 0;
}
.lil-gui.closed:not(.transition) > .children {
  display: none;
}
.lil-gui.transition > .children {
  transition-duration: 300ms;
  transition-property: height, opacity, transform;
  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);
  overflow: hidden;
  pointer-events: none;
}
.lil-gui .children:empty:before {
  content: "Empty";
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
  display: block;
  height: var(--widget-height);
  font-style: italic;
  line-height: var(--widget-height);
  opacity: 0.5;
}
.lil-gui.root > .children > .lil-gui > .title {
  border: 0 solid var(--widget-color);
  border-width: 1px 0;
  transition: border-color 300ms;
}
.lil-gui.root > .children > .lil-gui.closed > .title {
  border-bottom-color: transparent;
}
.lil-gui + .controller {
  border-top: 1px solid var(--widget-color);
  margin-top: 0;
  padding-top: var(--spacing);
}
.lil-gui .lil-gui .lil-gui > .title {
  border: none;
}
.lil-gui .lil-gui .lil-gui > .children {
  border: none;
  margin-left: var(--folder-indent);
  border-left: 2px solid var(--widget-color);
}
.lil-gui .lil-gui .controller {
  border: none;
}

.lil-gui label, .lil-gui input, .lil-gui button {
  -webkit-tap-highlight-color: transparent;
}
.lil-gui input {
  border: 0;
  outline: none;
  font-family: var(--font-family);
  font-size: var(--input-font-size);
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  background: var(--widget-color);
  color: var(--text-color);
  width: 100%;
}
@media (hover: hover) {
  .lil-gui input:hover {
    background: var(--hover-color);
  }
  .lil-gui input:active {
    background: var(--focus-color);
  }
}
.lil-gui input:disabled {
  opacity: 1;
}
.lil-gui input[type=text],
.lil-gui input[type=number] {
  padding: var(--widget-padding);
  -moz-appearance: textfield;
}
.lil-gui input[type=text]:focus,
.lil-gui input[type=number]:focus {
  background: var(--focus-color);
}
.lil-gui input[type=checkbox] {
  appearance: none;
  width: var(--checkbox-size);
  height: var(--checkbox-size);
  border-radius: var(--widget-border-radius);
  text-align: center;
  cursor: pointer;
}
.lil-gui input[type=checkbox]:checked:before {
  font-family: "lil-gui";
  content: "✓";
  font-size: var(--checkbox-size);
  line-height: var(--checkbox-size);
}
@media (hover: hover) {
  .lil-gui input[type=checkbox]:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui button {
  outline: none;
  cursor: pointer;
  font-family: var(--font-family);
  font-size: var(--font-size);
  color: var(--text-color);
  width: 100%;
  height: var(--widget-height);
  text-transform: none;
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
  border: none;
}
@media (hover: hover) {
  .lil-gui button:hover {
    background: var(--hover-color);
  }
  .lil-gui button:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui button:active {
  background: var(--focus-color);
}

@font-face {
  font-family: "lil-gui";
  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");
}`,_=!1;class M{constructor({parent:e,autoPlace:t=void 0===e,container:i,width:n,title:s="Controls",closeFolders:r=!1,injectStyles:o=!0,touchStyles:a=!0}={}){if(this.parent=e,this.root=e?e.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",e=>{("Enter"===e.code||"Space"===e.code)&&(e.preventDefault(),this.$title.click())}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(s),this.parent){this.parent.children.push(this),this.parent.folders.push(this),this.parent.$children.appendChild(this.domElement);return}this.domElement.classList.add("root"),a&&this.domElement.classList.add("allow-touch-styles"),!_&&o&&(function(e){let t=document.createElement("style");t.innerHTML=e;let i=document.querySelector("head link[rel=stylesheet], head style");i?document.head.insertBefore(t,i):document.head.appendChild(t)}(T),_=!0),i?i.appendChild(this.domElement):t&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),n&&this.domElement.style.setProperty("--width",n+"px"),this._closeFolders=r}add(e,t,i,n,s){if(Object(i)===i)return new E(this,e,t,i);let r=e[t];switch(typeof r){case"number":return new A(this,e,t,i,n,s);case"boolean":return new g(this,e,t);case"string":return new P(this,e,t);case"function":return new b(this,e,t)}console.error(`gui.add failed
	property:`,t,`
	object:`,e,`
	value:`,r)}addColor(e,t,i=1){return new v(this,e,t,i)}addFolder(e){let t=new M({parent:this,title:e});return this.root._closeFolders&&t.close(),t}load(e,t=!0){return e.controllers&&this.controllers.forEach(t=>{!(t instanceof b)&&t._name in e.controllers&&t.load(e.controllers[t._name])}),t&&e.folders&&this.folders.forEach(t=>{t._title in e.folders&&t.load(e.folders[t._title])}),this}save(e=!0){let t={controllers:{},folders:{}};return this.controllers.forEach(e=>{if(!(e instanceof b)){if(e._name in t.controllers)throw Error(`Cannot save GUI with duplicate property "${e._name}"`);t.controllers[e._name]=e.save()}}),e&&this.folders.forEach(e=>{if(e._title in t.folders)throw Error(`Cannot save GUI with duplicate folder "${e._title}"`);t.folders[e._title]=e.save()}),t}open(e=!0){return this._setClosed(!e),this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}_setClosed(e){this._closed!==e&&(this._closed=e,this._callOnOpenClose(this))}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(e=!0){return this._setClosed(!e),this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{let t=this.$children.clientHeight;this.$children.style.height=t+"px",this.domElement.classList.add("transition");let i=e=>{e.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",i))};this.$children.addEventListener("transitionend",i);let n=e?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!e),requestAnimationFrame(()=>{this.$children.style.height=n+"px"})}),this}title(e){return this._title=e,this.$title.textContent=e,this}reset(e=!0){return(e?this.controllersRecursive():this.controllers).forEach(e=>e.reset()),this}onChange(e){return this._onChange=e,this}_callOnChange(e){this.parent&&this.parent._callOnChange(e),void 0!==this._onChange&&this._onChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(e){this.parent&&this.parent._callOnFinishChange(e),void 0!==this._onFinishChange&&this._onFinishChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}onOpenClose(e){return this._onOpenClose=e,this}_callOnOpenClose(e){this.parent&&this.parent._callOnOpenClose(e),void 0!==this._onOpenClose&&this._onOpenClose.call(this,e)}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(e=>e.destroy())}controllersRecursive(){let e=Array.from(this.controllers);return this.folders.forEach(t=>{e=e.concat(t.controllersRecursive())}),e}foldersRecursive(){let e=Array.from(this.folders);return this.folders.forEach(t=>{e=e.concat(t.foldersRecursive())}),e}}function S(e,t){if(t===m.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t!==m.z$h&&t!==m.UlW)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e;{let i=e.getIndex();if(null===i){let t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),i=e.getIndex()}let n=i.count-2,s=[];if(t===m.z$h)for(let e=1;e<=n;e++)s.push(i.getX(0)),s.push(i.getX(e)),s.push(i.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(s.push(i.getX(e)),s.push(i.getX(e+1)),s.push(i.getX(e+2))):(s.push(i.getX(e+2)),s.push(i.getX(e+1)),s.push(i.getX(e)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let r=e.clone();return r.setIndex(s),r.clearGroups(),r}}class I extends m.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new D(e)}),this.register(function(e){return new z(e)}),this.register(function(e){return new X(e)}),this.register(function(e){return new Y(e)}),this.register(function(e){return new O(e)}),this.register(function(e){return new U(e)}),this.register(function(e){return new j(e)}),this.register(function(e){return new H(e)}),this.register(function(e){return new F(e)}),this.register(function(e){return new N(e)}),this.register(function(e){return new k(e)}),this.register(function(e){return new K(e)}),this.register(function(e){return new G(e)}),this.register(function(e){return new R(e)}),this.register(function(e){return new $(e)}),this.register(function(e){return new Z(e)})}load(e,t,i,n){let s;let r=this;if(""!==this.resourcePath)s=this.resourcePath;else if(""!==this.path){let t=m.Zp0.extractUrlBase(e);s=m.Zp0.resolveURL(t,this.path)}else s=m.Zp0.extractUrlBase(e);this.manager.itemStart(e);let o=function(t){n?n(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},a=new m.hH6(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(i){try{r.parse(i,s,function(i){t(i),r.manager.itemEnd(e)},o)}catch(e){o(e)}},i,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let s;let r={},o={},a=new TextDecoder;if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer){if(a.decode(new Uint8Array(e,0,4))===V){try{r[L.KHR_BINARY_GLTF]=new W(e)}catch(e){n&&n(e);return}s=JSON.parse(r[L.KHR_BINARY_GLTF].content)}else s=JSON.parse(a.decode(e))}else s=e;if(void 0===s.asset||s.asset.version[0]<2){n&&n(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let l=new ew(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){let t=this.pluginCallbacks[e](l);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[t.name]=t,r[t.name]=!0}if(s.extensionsUsed)for(let e=0;e<s.extensionsUsed.length;++e){let t=s.extensionsUsed[e],i=s.extensionsRequired||[];switch(t){case L.KHR_MATERIALS_UNLIT:r[t]=new B;break;case L.KHR_DRACO_MESH_COMPRESSION:r[t]=new q(s,this.dracoLoader);break;case L.KHR_TEXTURE_TRANSFORM:r[t]=new J;break;case L.KHR_MESH_QUANTIZATION:r[t]=new ee;break;default:i.indexOf(t)>=0&&void 0===o[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(r),l.setPlugins(o),l.parse(i,n)}parseAsync(e,t){let i=this;return new Promise(function(n,s){i.parse(e,t,n,s)})}}function C(){let e={};return{get:function(t){return e[t]},add:function(t,i){e[t]=i},remove:function(t){delete e[t]},removeAll:function(){e={}}}}let L={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class R{constructor(e){this.parser=e,this.name=L.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){let n=t[i];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){let t;let i=this.parser,n="light:"+e,s=i.cache.get(n);if(s)return s;let r=i.json,o=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e],a=new m.Ilk(16777215);void 0!==o.color&&a.setRGB(o.color[0],o.color[1],o.color[2],m.GUF);let l=void 0!==o.range?o.range:0;switch(o.type){case"directional":(t=new m.Ox3(a)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new m.cek(a)).distance=l;break;case"spot":(t=new m.PMe(a)).distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,t.angle=o.spot.outerConeAngle,t.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return t.position.set(0,0,0),t.decay=2,em(t,o),void 0!==o.intensity&&(t.intensity=o.intensity),t.name=i.createUniqueName(o.name||"light_"+e),s=Promise.resolve(t),i.cache.add(n,s),s}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){let t=this,i=this.parser,n=i.json.nodes[e],s=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===s?null:this._loadLight(s).then(function(e){return i._getNodeRef(t.cache,s,e)})}}class B{constructor(){this.name=L.KHR_MATERIALS_UNLIT}getMaterialType(){return m.vBJ}extendParams(e,t,i){let n=[];e.color=new m.Ilk(1,1,1),e.opacity=1;let s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){let t=s.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],m.GUF),e.opacity=t[3]}void 0!==s.baseColorTexture&&n.push(i.assignTexture(e,"map",s.baseColorTexture,m.KI_))}return Promise.all(n)}}class F{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=i.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class D{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?m.EJi:null}extendMaterialParams(e,t){let i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let s=[],r=n.extensions[this.name];if(void 0!==r.clearcoatFactor&&(t.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&s.push(i.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(s.push(i.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){let e=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new m.FM8(e,e)}return Promise.all(s)}}class k{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?m.EJi:null}extendMaterialParams(e,t){let i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let s=[],r=n.extensions[this.name];return void 0!==r.iridescenceFactor&&(t.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&s.push(i.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(t.iridescenceIOR=r.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&s.push(i.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(s)}}class O{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_SHEEN}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?m.EJi:null}extendMaterialParams(e,t){let i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let s=[];t.sheenColor=new m.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;let r=n.extensions[this.name];if(void 0!==r.sheenColorFactor){let e=r.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],m.GUF)}return void 0!==r.sheenRoughnessFactor&&(t.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&s.push(i.assignTexture(t,"sheenColorMap",r.sheenColorTexture,m.KI_)),void 0!==r.sheenRoughnessTexture&&s.push(i.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(s)}}class U{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?m.EJi:null}extendMaterialParams(e,t){let i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let s=[],r=n.extensions[this.name];return void 0!==r.transmissionFactor&&(t.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&s.push(i.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(s)}}class j{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_VOLUME}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?m.EJi:null}extendMaterialParams(e,t){let i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let s=[],r=n.extensions[this.name];t.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&s.push(i.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;let o=r.attenuationColor||[1,1,1];return t.attenuationColor=new m.Ilk().setRGB(o[0],o[1],o[2],m.GUF),Promise.all(s)}}class H{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_IOR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?m.EJi:null}extendMaterialParams(e,t){let i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=i.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class N{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_SPECULAR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?m.EJi:null}extendMaterialParams(e,t){let i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let s=[],r=n.extensions[this.name];t.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&s.push(i.assignTexture(t,"specularIntensityMap",r.specularTexture));let o=r.specularColorFactor||[1,1,1];return t.specularColor=new m.Ilk().setRGB(o[0],o[1],o[2],m.GUF),void 0!==r.specularColorTexture&&s.push(i.assignTexture(t,"specularColorMap",r.specularColorTexture,m.KI_)),Promise.all(s)}}class G{constructor(e){this.parser=e,this.name=L.EXT_MATERIALS_BUMP}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?m.EJi:null}extendMaterialParams(e,t){let i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let s=[],r=n.extensions[this.name];return t.bumpScale=void 0!==r.bumpFactor?r.bumpFactor:1,void 0!==r.bumpTexture&&s.push(i.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(s)}}class K{constructor(e){this.parser=e,this.name=L.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?m.EJi:null}extendMaterialParams(e,t){let i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let s=[],r=n.extensions[this.name];return void 0!==r.anisotropyStrength&&(t.anisotropy=r.anisotropyStrength),void 0!==r.anisotropyRotation&&(t.anisotropyRotation=r.anisotropyRotation),void 0!==r.anisotropyTexture&&s.push(i.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(s)}}class z{constructor(e){this.parser=e,this.name=L.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;let s=n.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(!(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return t.loadTextureImage(e,s.source,r)}}class X{constructor(e){this.parser=e,this.name=L.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,i=this.parser,n=i.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;let r=s.extensions[t],o=n.images[r.source],a=i.textureLoader;if(o.uri){let e=i.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then(function(s){if(s)return i.loadTextureImage(e,r.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class Y{constructor(e){this.parser=e,this.name=L.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let t=this.name,i=this.parser,n=i.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;let r=s.extensions[t],o=n.images[r.source],a=i.textureLoader;if(o.uri){let e=i.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then(function(s){if(s)return i.loadTextureImage(e,r.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class ${constructor(e){this.name=L.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,i=t.bufferViews[e];if(!i.extensions||!i.extensions[this.name])return null;{let e=i.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(!(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return n.then(function(t){let i=e.byteOffset||0,n=e.byteLength||0,r=e.count,o=e.byteStride,a=new Uint8Array(t,i,n);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(r,o,a,e.mode,e.filter).then(function(e){return e.buffer}):s.ready.then(function(){let t=new ArrayBuffer(r*o);return s.decodeGltfBuffer(new Uint8Array(t),r,o,a,e.mode,e.filter),t})})}}}class Z{constructor(e){this.name=L.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){let t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;for(let e of t.meshes[i.mesh].primitives)if(e.mode!==es.TRIANGLES&&e.mode!==es.TRIANGLE_STRIP&&e.mode!==es.TRIANGLE_FAN&&void 0!==e.mode)return null;let n=i.extensions[this.name].attributes,s=[],r={};for(let e in n)s.push(this.parser.getDependency("accessor",n[e]).then(t=>(r[e]=t,r[e])));return s.length<1?null:(s.push(this.parser.createNodeMesh(e)),Promise.all(s).then(e=>{let t=e.pop(),i=t.isGroup?t.children:[t],n=e[0].count,s=[];for(let e of i){let t=new m.yGw,i=new m.Pa4,o=new m._fP,a=new m.Pa4(1,1,1),l=new m.SPe(e.geometry,e.material,n);for(let e=0;e<n;e++)r.TRANSLATION&&i.fromBufferAttribute(r.TRANSLATION,e),r.ROTATION&&o.fromBufferAttribute(r.ROTATION,e),r.SCALE&&a.fromBufferAttribute(r.SCALE,e),l.setMatrixAt(e,t.compose(i,o,a));for(let t in r)if("_COLOR_0"===t){let e=r[t];l.instanceColor=new m.lb7(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,r[t]);m.Tme.prototype.copy.call(l,e),this.parser.assignFinalMaterial(l),s.push(l)}return t.isGroup?(t.clear(),t.add(...s),t):s[0]}))}}let V="glTF",Q={JSON:1313821514,BIN:5130562};class W{constructor(e){this.name=L.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==V)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");let n=this.header.length-12,s=new DataView(e,12),r=0;for(;r<n;){let t=s.getUint32(r,!0);r+=4;let n=s.getUint32(r,!0);if(r+=4,n===Q.JSON){let n=new Uint8Array(e,12+r,t);this.content=i.decode(n)}else if(n===Q.BIN){let i=12+r;this.body=e.slice(i,i+t)}r+=t}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}}class q{constructor(e,t){if(!t)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=L.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let i=this.json,n=this.dracoLoader,s=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,o={},a={},l={};for(let e in r)o[eh[e]||e.toLowerCase()]=r[e];for(let t in e.attributes){let n=eh[t]||t.toLowerCase();if(void 0!==r[t]){let s=i.accessors[e.attributes[t]],r=er[s.componentType];l[n]=r.name,a[n]=!0===s.normalized}}return t.getDependency("bufferView",s).then(function(e){return new Promise(function(t,i){n.decodeDracoFile(e,function(e){for(let t in e.attributes){let i=e.attributes[t],n=a[t];void 0!==n&&(i.normalized=n)}t(e)},o,l,m.GUF,i)})})}}class J{constructor(){this.name=L.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class ee{constructor(){this.name=L.KHR_MESH_QUANTIZATION}}class et extends m._C8{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=e*n*3+n;for(let e=0;e!==n;e++)t[e]=i[s+e];return t}interpolate_(e,t,i,n){let s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,h=n-t,c=(i-t)/h,d=c*c,u=d*c,p=e*l,m=p-l,f=-2*u+3*d,g=u-d,y=1-f,w=g-d+c;for(let e=0;e!==o;e++){let t=r[m+e+o],i=r[m+e+a]*h,n=r[p+e+o],l=r[p+e]*h;s[e]=y*t+w*i+f*n+g*l}return s}}let ei=new m._fP;class en extends et{interpolate_(e,t,i,n){let s=super.interpolate_(e,t,i,n);return ei.fromArray(s).normalize().toArray(s),s}}let es={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},er={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},eo={9728:m.TyD,9729:m.wem,9984:m.YLQ,9985:m.qyh,9986:m.aH4,9987:m.D1R},ea={33071:m.uWy,33648:m.OoA,10497:m.rpg},el={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},eh={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ec={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ed={CUBICSPLINE:void 0,LINEAR:m.NMF,STEP:m.Syv},eu={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function ep(e,t,i){for(let n in i.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=i.extensions[n])}function em(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function ef(e){let t="",i=Object.keys(e).sort();for(let n=0,s=i.length;n<s;n++)t+=i[n]+":"+e[i[n]]+";";return t}function eg(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}let ey=new m.yGw;class ew{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new C,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=!1,s=-1;"undefined"!=typeof navigator&&(i=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),s=(n=navigator.userAgent.indexOf("Firefox")>-1)?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||i||n&&s<98?this.textureLoader=new m.dpR(this.options.manager):this.textureLoader=new m.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new m.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let i=this,n=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(t){let r={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:i,userData:{}};return ep(s,r,n),em(r,n),Promise.all(i._invokeAll(function(e){return e.afterRoot&&e.afterRoot(r)})).then(function(){e(r)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let i=0,n=t.length;i<n;i++){let n=t[i].joints;for(let t=0,i=n.length;t<i;t++)e[n[t]].isBone=!0}for(let t=0,n=e.length;t<n;t++){let n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(i[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;let n=i.clone(),s=(e,t)=>{let i=this.associations.get(e);for(let[n,r]of(null!=i&&this.associations.set(t,i),e.children.entries()))s(r,t.children[n])};return s(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){let n=e(t[i]);if(n)return n}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let i=[];for(let n=0;n<t.length;n++){let s=e(t[n]);s&&i.push(s)}return i}getDependency(e,t){let i=e+":"+t,n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":n=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(!(n=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,t)})))throw Error("Unknown type: "+e)}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){let i=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(t,n){return i.getDependency(e,n)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[L.KHR_BINARY_GLTF].body);let n=this.options;return new Promise(function(e,s){i.load(m.Zp0.resolveURL(t.uri,n.path),e,void 0,function(){s(Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){let i=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+i)})}loadAccessor(e){let t=this,i=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse){let e=el[n.type],t=er[n.componentType],i=!0===n.normalized,s=new t(n.count*e);return Promise.resolve(new m.TlE(s,e,i))}let s=[];return void 0!==n.bufferView?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),void 0!==n.sparse&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then(function(e){let s,r;let o=e[0],a=el[n.type],l=er[n.componentType],h=l.BYTES_PER_ELEMENT,c=h*a,d=n.byteOffset||0,u=void 0!==n.bufferView?i.bufferViews[n.bufferView].byteStride:void 0,p=!0===n.normalized;if(u&&u!==c){let e=Math.floor(d/u),i="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count,c=t.cache.get(i);c||(s=new l(o,e*u,n.count*u/h),c=new m.vpT(s,u/h),t.cache.add(i,c)),r=new m.kB5(c,a,d%u/h,p)}else s=null===o?new l(n.count*a):new l(o,d,n.count*a),r=new m.TlE(s,a,p);if(void 0!==n.sparse){let t=el.SCALAR,i=er[n.sparse.indices.componentType],s=n.sparse.indices.byteOffset||0,h=n.sparse.values.byteOffset||0,c=new i(e[1],s,n.sparse.count*t),d=new l(e[2],h,n.sparse.count*a);null!==o&&(r=new m.TlE(r.array.slice(),r.itemSize,r.normalized));for(let e=0,t=c.length;e<t;e++){let t=c[e];if(r.setX(t,d[e*a]),a>=2&&r.setY(t,d[e*a+1]),a>=3&&r.setZ(t,d[e*a+2]),a>=4&&r.setW(t,d[e*a+3]),a>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return r})}loadTexture(e){let t=this.json,i=this.options,n=t.textures[e].source,s=t.images[n],r=this.textureLoader;if(s.uri){let e=i.manager.getHandler(s.uri);null!==e&&(r=e)}return this.loadTextureImage(e,n,r)}loadTextureImage(e,t,i){let n=this,s=this.json,r=s.textures[e],o=s.images[t],a=(o.uri||o.bufferView)+":"+r.sampler;if(this.textureCache[a])return this.textureCache[a];let l=this.loadImageSource(t,i).then(function(t){t.flipY=!1,t.name=r.name||o.name||"",""===t.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(t.name=o.uri);let i=(s.samplers||{})[r.sampler]||{};return t.magFilter=eo[i.magFilter]||m.wem,t.minFilter=eo[i.minFilter]||m.D1R,t.wrapS=ea[i.wrapS]||m.rpg,t.wrapT=ea[i.wrapT]||m.rpg,n.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(e,t){let i=this.json,n=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());let s=i.images[e],r=self.URL||self.webkitURL,o=s.uri||"",a=!1;if(void 0!==s.bufferView)o=this.getDependency("bufferView",s.bufferView).then(function(e){a=!0;let t=new Blob([e],{type:s.mimeType});return o=r.createObjectURL(t)});else if(void 0===s.uri)throw Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let l=Promise.resolve(o).then(function(e){return new Promise(function(i,s){let r=i;!0===t.isImageBitmapLoader&&(r=function(e){let t=new m.xEZ(e);t.needsUpdate=!0,i(t)}),t.load(m.Zp0.resolveURL(e,n.path),r,void 0,s)})}).then(function(e){var t;return!0===a&&r.revokeObjectURL(o),e.userData.mimeType=s.mimeType||((t=s.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e});return this.sourceCache[e]=l,l}assignTexture(e,t,i,n){let s=this;return this.getDependency("texture",i.index).then(function(r){if(!r)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((r=r.clone()).channel=i.texCoord),s.extensions[L.KHR_TEXTURE_TRANSFORM]){let e=void 0!==i.extensions?i.extensions[L.KHR_TEXTURE_TRANSFORM]:void 0;if(e){let t=s.associations.get(r);r=s.extensions[L.KHR_TEXTURE_TRANSFORM].extendTexture(r,e),s.associations.set(r,t)}}return void 0!==n&&(r.colorSpace=n),e[t]=r,r})}assignFinalMaterial(e){let t=e.geometry,i=e.material,n=void 0===t.attributes.tangent,s=void 0!==t.attributes.color,r=void 0===t.attributes.normal;if(e.isPoints){let e="PointsMaterial:"+i.uuid,t=this.cache.get(e);t||(t=new m.UY4,m.F5T.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,t.sizeAttenuation=!1,this.cache.add(e,t)),i=t}else if(e.isLine){let e="LineBasicMaterial:"+i.uuid,t=this.cache.get(e);t||(t=new m.nls,m.F5T.prototype.copy.call(t,i),t.color.copy(i.color),t.map=i.map,this.cache.add(e,t)),i=t}if(n||s||r){let e="ClonedMaterial:"+i.uuid+":";n&&(e+="derivative-tangents:"),s&&(e+="vertex-colors:"),r&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=i.clone(),s&&(t.vertexColors=!0),r&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(i))),i=t}e.material=i}getMaterialType(){return m.Wid}loadMaterial(e){let t;let i=this,n=this.json,s=this.extensions,r=n.materials[e],o={},a=r.extensions||{},l=[];if(a[L.KHR_MATERIALS_UNLIT]){let e=s[L.KHR_MATERIALS_UNLIT];t=e.getMaterialType(),l.push(e.extendParams(o,r,i))}else{let n=r.pbrMetallicRoughness||{};if(o.color=new m.Ilk(1,1,1),o.opacity=1,Array.isArray(n.baseColorFactor)){let e=n.baseColorFactor;o.color.setRGB(e[0],e[1],e[2],m.GUF),o.opacity=e[3]}void 0!==n.baseColorTexture&&l.push(i.assignTexture(o,"map",n.baseColorTexture,m.KI_)),o.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,o.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(l.push(i.assignTexture(o,"metalnessMap",n.metallicRoughnessTexture)),l.push(i.assignTexture(o,"roughnessMap",n.metallicRoughnessTexture))),t=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)})))}!0===r.doubleSided&&(o.side=m.ehD);let h=r.alphaMode||eu.OPAQUE;if(h===eu.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,h===eu.MASK&&(o.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&t!==m.vBJ&&(l.push(i.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new m.FM8(1,1),void 0!==r.normalTexture.scale)){let e=r.normalTexture.scale;o.normalScale.set(e,e)}if(void 0!==r.occlusionTexture&&t!==m.vBJ&&(l.push(i.assignTexture(o,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(o.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&t!==m.vBJ){let e=r.emissiveFactor;o.emissive=new m.Ilk().setRGB(e[0],e[1],e[2],m.GUF)}return void 0!==r.emissiveTexture&&t!==m.vBJ&&l.push(i.assignTexture(o,"emissiveMap",r.emissiveTexture,m.KI_)),Promise.all(l).then(function(){let n=new t(o);return r.name&&(n.name=r.name),em(n,r),i.associations.set(n,{materials:e}),r.extensions&&ep(s,n,r),n})}createUniqueName(e){let t=m.iUV.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){let t=this,i=this.extensions,n=this.primitiveCache,s=[];for(let r=0,o=e.length;r<o;r++){let o=e[r],a=function(e){let t;let i=e.extensions&&e.extensions[L.KHR_DRACO_MESH_COMPRESSION];if(t=i?"draco:"+i.bufferView+":"+i.indices+":"+ef(i.attributes):e.indices+":"+ef(e.attributes)+":"+e.mode,void 0!==e.targets)for(let i=0,n=e.targets.length;i<n;i++)t+=":"+ef(e.targets[i]);return t}(o),l=n[a];if(l)s.push(l.promise);else{let e;e=o.extensions&&o.extensions[L.KHR_DRACO_MESH_COMPRESSION]?function(e){return i[L.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(i){return ex(i,e,t)})}(o):ex(new m.u9r,o,t),n[a]={primitive:o,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){let t=this,i=this.json,n=this.extensions,s=i.meshes[e],r=s.primitives,o=[];for(let e=0,t=r.length;e<t;e++){var a;let t=void 0===r[e].material?(void 0===(a=this.cache).DefaultMaterial&&(a.DefaultMaterial=new m.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:m.Wl3})),a.DefaultMaterial):this.getDependency("material",r[e].material);o.push(t)}return o.push(t.loadGeometries(r)),Promise.all(o).then(function(i){let o=i.slice(0,i.length-1),a=i[i.length-1],l=[];for(let i=0,h=a.length;i<h;i++){let h;let c=a[i],d=r[i],u=o[i];if(d.mode===es.TRIANGLES||d.mode===es.TRIANGLE_STRIP||d.mode===es.TRIANGLE_FAN||void 0===d.mode)!0===(h=!0===s.isSkinnedMesh?new m.TUv(c,u):new m.Kj0(c,u)).isSkinnedMesh&&h.normalizeSkinWeights(),d.mode===es.TRIANGLE_STRIP?h.geometry=S(h.geometry,m.UlW):d.mode===es.TRIANGLE_FAN&&(h.geometry=S(h.geometry,m.z$h));else if(d.mode===es.LINES)h=new m.ejS(c,u);else if(d.mode===es.LINE_STRIP)h=new m.x12(c,u);else if(d.mode===es.LINE_LOOP)h=new m.blk(c,u);else if(d.mode===es.POINTS)h=new m.woe(c,u);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);Object.keys(h.geometry.morphAttributes).length>0&&function(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let i=0,n=t.weights.length;i<n;i++)e.morphTargetInfluences[i]=t.weights[i];if(t.extras&&Array.isArray(t.extras.targetNames)){let i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(let t=0,n=i.length;t<n;t++)e.morphTargetDictionary[i[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(h,s),h.name=t.createUniqueName(s.name||"mesh_"+e),em(h,s),d.extensions&&ep(n,h,d),t.assignFinalMaterial(h),l.push(h)}for(let i=0,n=l.length;i<n;i++)t.associations.set(l[i],{meshes:e,primitives:i});if(1===l.length)return s.extensions&&ep(n,l[0],s),l[0];let h=new m.ZAu;s.extensions&&ep(n,h,s),t.associations.set(h,{meshes:e});for(let e=0,t=l.length;e<t;e++)h.add(l[e]);return h})}loadCamera(e){let t;let i=this.json.cameras[e],n=i[i.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===i.type?t=new m.cPb(m.M8C.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===i.type&&(t=new m.iKG(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),em(t,i),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],i=[];for(let e=0,n=t.joints.length;e<n;e++)i.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(e){let i=e.pop(),n=[],s=[];for(let r=0,o=e.length;r<o;r++){let o=e[r];if(o){n.push(o);let e=new m.yGw;null!==i&&e.fromArray(i.array,16*r),s.push(e)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[r])}return new m.OdW(n,s)})}loadAnimation(e){let t=this.json,i=this,n=t.animations[e],s=n.name?n.name:"animation_"+e,r=[],o=[],a=[],l=[],h=[];for(let e=0,t=n.channels.length;e<t;e++){let t=n.channels[e],i=n.samplers[t.sampler],s=t.target,c=s.node,d=void 0!==n.parameters?n.parameters[i.input]:i.input,u=void 0!==n.parameters?n.parameters[i.output]:i.output;void 0!==s.node&&(r.push(this.getDependency("node",c)),o.push(this.getDependency("accessor",d)),a.push(this.getDependency("accessor",u)),l.push(i),h.push(s))}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(h)]).then(function(e){let t=e[0],n=e[1],r=e[2],o=e[3],a=e[4],l=[];for(let e=0,s=t.length;e<s;e++){let s=t[e],h=n[e],c=r[e],d=o[e],u=a[e];if(void 0===s)continue;s.updateMatrix&&s.updateMatrix();let p=i._createAnimationTracks(s,h,c,d,u);if(p)for(let e=0;e<p.length;e++)l.push(p[e])}return new m.m7l(s,void 0,l)})}createNodeMesh(e){let t=this.json,i=this,n=t.nodes[e];return void 0===n.mesh?null:i.getDependency("mesh",n.mesh).then(function(e){let t=i._getNodeRef(i.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,i=n.weights.length;t<i;t++)e.morphTargetInfluences[t]=n.weights[t]}),t})}loadNode(e){let t=this.json.nodes[e],i=this._loadNodeShallow(e),n=[],s=t.children||[];for(let e=0,t=s.length;e<t;e++)n.push(this.getDependency("node",s[e]));let r=void 0===t.skin?Promise.resolve(null):this.getDependency("skin",t.skin);return Promise.all([i,Promise.all(n),r]).then(function(e){let t=e[0],i=e[1],n=e[2];null!==n&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(n,ey)});for(let e=0,n=i.length;e<n;e++)t.add(i[e]);return t})}_loadNodeShallow(e){let t=this.json,i=this.extensions,n=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];let s=t.nodes[e],r=s.name?n.createUniqueName(s.name):"",o=[],a=n._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return a&&o.push(a),void 0!==s.camera&&o.push(n.getDependency("camera",s.camera).then(function(e){return n._getNodeRef(n.cameraCache,s.camera,e)})),n._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){o.push(e)}),this.nodeCache[e]=Promise.all(o).then(function(t){let o;if((o=!0===s.isBone?new m.N$j:t.length>1?new m.ZAu:1===t.length?t[0]:new m.Tme)!==t[0])for(let e=0,i=t.length;e<i;e++)o.add(t[e]);if(s.name&&(o.userData.name=s.name,o.name=r),em(o,s),s.extensions&&ep(i,o,s),void 0!==s.matrix){let e=new m.yGw;e.fromArray(s.matrix),o.applyMatrix4(e)}else void 0!==s.translation&&o.position.fromArray(s.translation),void 0!==s.rotation&&o.quaternion.fromArray(s.rotation),void 0!==s.scale&&o.scale.fromArray(s.scale);return n.associations.has(o)||n.associations.set(o,{}),n.associations.get(o).nodes=e,o}),this.nodeCache[e]}loadScene(e){let t=this.extensions,i=this.json.scenes[e],n=this,s=new m.ZAu;i.name&&(s.name=n.createUniqueName(i.name)),em(s,i),i.extensions&&ep(t,s,i);let r=i.nodes||[],o=[];for(let e=0,t=r.length;e<t;e++)o.push(n.getDependency("node",r[e]));return Promise.all(o).then(function(e){for(let t=0,i=e.length;t<i;t++)s.add(e[t]);return n.associations=(e=>{let t=new Map;for(let[e,i]of n.associations)(e instanceof m.F5T||e instanceof m.xEZ)&&t.set(e,i);return e.traverse(e=>{let i=n.associations.get(e);null!=i&&t.set(e,i)}),t})(s),s})}_createAnimationTracks(e,t,i,n,s){let r;let o=[],a=e.name?e.name:e.uuid,l=[];switch(ec[s.path]===ec.weights?e.traverse(function(e){e.morphTargetInfluences&&l.push(e.name?e.name:e.uuid)}):l.push(a),ec[s.path]){case ec.weights:r=m.dUE;break;case ec.rotation:r=m.iLg;break;case ec.position:case ec.scale:r=m.yC1;break;default:r=1===i.itemSize?m.dUE:m.yC1}let h=void 0!==n.interpolation?ed[n.interpolation]:m.NMF,c=this._getArrayFromAccessor(i);for(let e=0,i=l.length;e<i;e++){let i=new r(l[e]+"."+ec[s.path],t.array,c,h);"CUBICSPLINE"===n.interpolation&&this._createCubicSplineTrackInterpolant(i),o.push(i)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){let e=eg(t.constructor),i=new Float32Array(t.length);for(let n=0,s=t.length;n<s;n++)i[n]=t[n]*e;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof m.iLg?en:et)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function ex(e,t,i){let n=t.attributes,s=[];for(let t in n){let r=eh[t]||t.toLowerCase();r in e.attributes||s.push(function(t,n){return i.getDependency("accessor",t).then(function(t){e.setAttribute(n,t)})}(n[t],r))}if(void 0!==t.indices&&!e.index){let n=i.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});s.push(n)}return m.epp.workingColorSpace!==m.GUF&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${m.epp.workingColorSpace}" not supported.`),em(e,t),function(e,t,i){let n=t.attributes,s=new m.ZzF;if(void 0===n.POSITION)return;{let e=i.json.accessors[n.POSITION],t=e.min,r=e.max;if(void 0!==t&&void 0!==r){if(s.set(new m.Pa4(t[0],t[1],t[2]),new m.Pa4(r[0],r[1],r[2])),e.normalized){let t=eg(er[e.componentType]);s.min.multiplyScalar(t),s.max.multiplyScalar(t)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}let r=t.targets;if(void 0!==r){let e=new m.Pa4,t=new m.Pa4;for(let n=0,s=r.length;n<s;n++){let s=r[n];if(void 0!==s.POSITION){let n=i.json.accessors[s.POSITION],r=n.min,o=n.max;if(void 0!==r&&void 0!==o){if(t.setX(Math.max(Math.abs(r[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(r[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(r[2]),Math.abs(o[2]))),n.normalized){let e=eg(er[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(e)}e.boundingBox=s;let o=new m.aLr;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=o}(e,t,i),Promise.all(s).then(function(){return void 0!==t.targets?function(e,t,i){let n=!1,s=!1,r=!1;for(let e=0,i=t.length;e<i;e++){let i=t[e];if(void 0!==i.POSITION&&(n=!0),void 0!==i.NORMAL&&(s=!0),void 0!==i.COLOR_0&&(r=!0),n&&s&&r)break}if(!n&&!s&&!r)return Promise.resolve(e);let o=[],a=[],l=[];for(let h=0,c=t.length;h<c;h++){let c=t[h];if(n){let t=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION):e.attributes.position;o.push(t)}if(s){let t=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL):e.attributes.normal;a.push(t)}if(r){let t=void 0!==c.COLOR_0?i.getDependency("accessor",c.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(t){let i=t[0],o=t[1],a=t[2];return n&&(e.morphAttributes.position=i),s&&(e.morphAttributes.normal=o),r&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e})}(e,t.targets,i):e})}let ev={type:"change"},eb={type:"start"},eA={type:"end"},eE=new m.zHn,eP=new m.JOQ,eT=Math.cos(70*m.M8C.DEG2RAD);class e_ extends m.pBf{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new m.Pa4,this.cursor=new m.Pa4,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:m.RsA.ROTATE,MIDDLE:m.RsA.DOLLY,RIGHT:m.RsA.PAN},this.touches={ONE:m.QmN.ROTATE,TWO:m.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",V),this._domElementKeyEvents=e},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",V),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(ev),i.update(),s=n.NONE},this.update=function(){let t=new m.Pa4,c=new m._fP().setFromUnitVectors(e.up,new m.Pa4(0,1,0)),d=c.clone().invert(),u=new m.Pa4,p=new m._fP,f=new m.Pa4,g=2*Math.PI;return function(y=null){let w=i.object.position;t.copy(w).sub(i.target),t.applyQuaternion(c),o.setFromVector3(t),i.autoRotate&&s===n.NONE&&M(null!==y?2*Math.PI/60*i.autoRotateSpeed*y:2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(o.theta+=a.theta*i.dampingFactor,o.phi+=a.phi*i.dampingFactor):(o.theta+=a.theta,o.phi+=a.phi);let x=i.minAzimuthAngle,E=i.maxAzimuthAngle;isFinite(x)&&isFinite(E)&&(x<-Math.PI?x+=g:x>Math.PI&&(x-=g),E<-Math.PI?E+=g:E>Math.PI&&(E-=g),x<=E?o.theta=Math.max(x,Math.min(E,o.theta)):o.theta=o.theta>(x+E)/2?Math.max(x,o.theta):Math.min(E,o.theta)),o.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,o.phi)),o.makeSafe(),!0===i.enableDamping?i.target.addScaledVector(h,i.dampingFactor):i.target.add(h),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor),i.zoomToCursor&&A||i.object.isOrthographicCamera?o.radius=D(o.radius):o.radius=D(o.radius*l),t.setFromSpherical(o),t.applyQuaternion(d),w.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(a.theta*=1-i.dampingFactor,a.phi*=1-i.dampingFactor,h.multiplyScalar(1-i.dampingFactor)):(a.set(0,0,0),h.set(0,0,0));let P=!1;if(i.zoomToCursor&&A){let n=null;if(i.object.isPerspectiveCamera){let e=t.length();n=D(e*l);let s=e-n;i.object.position.addScaledVector(v,s),i.object.updateMatrixWorld()}else if(i.object.isOrthographicCamera){let e=new m.Pa4(b.x,b.y,0);e.unproject(i.object),i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/l)),i.object.updateProjectionMatrix(),P=!0;let s=new m.Pa4(b.x,b.y,0);s.unproject(i.object),i.object.position.sub(s).add(e),i.object.updateMatrixWorld(),n=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;null!==n&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(n).add(i.object.position):(eE.origin.copy(i.object.position),eE.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(eE.direction))<eT?e.lookAt(i.target):(eP.setFromNormalAndCoplanarPoint(i.object.up,i.target),eE.intersectPlane(eP,i.target))))}else i.object.isOrthographicCamera&&(P=1!==l)&&(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/l)),i.object.updateProjectionMatrix());return l=1,A=!1,!!(P||u.distanceToSquared(i.object.position)>r||8*(1-p.dot(i.object.quaternion))>r||f.distanceToSquared(i.target)>0)&&(i.dispatchEvent(ev),u.copy(i.object.position),p.copy(i.object.quaternion),f.copy(i.target),!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",W),i.domElement.removeEventListener("pointerdown",z),i.domElement.removeEventListener("pointercancel",Y),i.domElement.removeEventListener("wheel",$),i.domElement.removeEventListener("pointermove",X),i.domElement.removeEventListener("pointerup",Y),null!==i._domElementKeyEvents&&(i._domElementKeyEvents.removeEventListener("keydown",V),i._domElementKeyEvents=null)};let i=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},s=n.NONE,r=1e-6,o=new m.$V,a=new m.$V,l=1,h=new m.Pa4,c=new m.FM8,d=new m.FM8,u=new m.FM8,p=new m.FM8,f=new m.FM8,g=new m.FM8,y=new m.FM8,w=new m.FM8,x=new m.FM8,v=new m.Pa4,b=new m.FM8,A=!1,E=[],P={},T=!1;function _(e){return Math.pow(.95,i.zoomSpeed*Math.abs(.01*e))}function M(e){a.theta-=e}function S(e){a.phi-=e}let I=function(){let e=new m.Pa4;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),h.add(e)}}(),C=function(){let e=new m.Pa4;return function(t,n){!0===i.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),h.add(e)}}(),L=function(){let e=new m.Pa4;return function(t,n){let s=i.domElement;if(i.object.isPerspectiveCamera){let r=i.object.position;e.copy(r).sub(i.target);let o=e.length();I(2*t*(o*=Math.tan(i.object.fov/2*Math.PI/180))/s.clientHeight,i.object.matrix),C(2*n*o/s.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(I(t*(i.object.right-i.object.left)/i.object.zoom/s.clientWidth,i.object.matrix),C(n*(i.object.top-i.object.bottom)/i.object.zoom/s.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function R(e){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?l/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function B(e){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?l*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function F(e,t){if(!i.zoomToCursor)return;A=!0;let n=i.domElement.getBoundingClientRect(),s=e-n.left,r=t-n.top,o=n.width,a=n.height;b.x=s/o*2-1,b.y=-(r/a*2)+1,v.set(b.x,b.y,1).unproject(i.object).sub(i.object.position).normalize()}function D(e){return Math.max(i.minDistance,Math.min(i.maxDistance,e))}function k(e){c.set(e.clientX,e.clientY)}function O(e){p.set(e.clientX,e.clientY)}function U(e){if(1===E.length)c.set(e.pageX,e.pageY);else{let t=J(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);c.set(i,n)}}function j(e){if(1===E.length)p.set(e.pageX,e.pageY);else{let t=J(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);p.set(i,n)}}function H(e){let t=J(e),i=e.pageX-t.x,n=e.pageY-t.y;y.set(0,Math.sqrt(i*i+n*n))}function N(e){if(1==E.length)d.set(e.pageX,e.pageY);else{let t=J(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);d.set(i,n)}u.subVectors(d,c).multiplyScalar(i.rotateSpeed);let t=i.domElement;M(2*Math.PI*u.x/t.clientHeight),S(2*Math.PI*u.y/t.clientHeight),c.copy(d)}function G(e){if(1===E.length)f.set(e.pageX,e.pageY);else{let t=J(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);f.set(i,n)}g.subVectors(f,p).multiplyScalar(i.panSpeed),L(g.x,g.y),p.copy(f)}function K(e){let t=J(e),n=e.pageX-t.x,s=e.pageY-t.y;w.set(0,Math.sqrt(n*n+s*s)),x.set(0,Math.pow(w.y/y.y,i.zoomSpeed)),R(x.y),y.copy(w),F((e.pageX+t.x)*.5,(e.pageY+t.y)*.5)}function z(e){!1!==i.enabled&&(0===E.length&&(i.domElement.setPointerCapture(e.pointerId),i.domElement.addEventListener("pointermove",X),i.domElement.addEventListener("pointerup",Y)),E.push(e.pointerId),"touch"===e.pointerType?Q(e):function(e){let t;switch(e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case m.RsA.DOLLY:if(!1===i.enableZoom)return;F(e.clientX,e.clientX),y.set(e.clientX,e.clientY),s=n.DOLLY;break;case m.RsA.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;O(e),s=n.PAN}else{if(!1===i.enableRotate)return;k(e),s=n.ROTATE}break;case m.RsA.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;k(e),s=n.ROTATE}else{if(!1===i.enablePan)return;O(e),s=n.PAN}break;default:s=n.NONE}s!==n.NONE&&i.dispatchEvent(eb)}(e))}function X(e){!1!==i.enabled&&("touch"===e.pointerType?function(e){switch(q(e),s){case n.TOUCH_ROTATE:if(!1===i.enableRotate)return;N(e),i.update();break;case n.TOUCH_PAN:if(!1===i.enablePan)return;G(e),i.update();break;case n.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&K(e),i.enablePan&&G(e),i.update();break;case n.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&K(e),i.enableRotate&&N(e),i.update();break;default:s=n.NONE}}(e):function(e){switch(s){case n.ROTATE:if(!1===i.enableRotate)return;!function(e){d.set(e.clientX,e.clientY),u.subVectors(d,c).multiplyScalar(i.rotateSpeed);let t=i.domElement;M(2*Math.PI*u.x/t.clientHeight),S(2*Math.PI*u.y/t.clientHeight),c.copy(d),i.update()}(e);break;case n.DOLLY:if(!1===i.enableZoom)return;w.set(e.clientX,e.clientY),x.subVectors(w,y),x.y>0?R(_(x.y)):x.y<0&&B(_(x.y)),y.copy(w),i.update();break;case n.PAN:if(!1===i.enablePan)return;f.set(e.clientX,e.clientY),g.subVectors(f,p).multiplyScalar(i.panSpeed),L(g.x,g.y),p.copy(f),i.update()}}(e))}function Y(e){switch(function(e){delete P[e.pointerId];for(let t=0;t<E.length;t++)if(E[t]==e.pointerId){E.splice(t,1);return}}(e),E.length){case 0:i.domElement.releasePointerCapture(e.pointerId),i.domElement.removeEventListener("pointermove",X),i.domElement.removeEventListener("pointerup",Y),i.dispatchEvent(eA),s=n.NONE;break;case 1:let t=E[0],r=P[t];Q({pointerId:t,pageX:r.x,pageY:r.y})}}function $(e){if(!1!==i.enabled&&!1!==i.enableZoom&&s===n.NONE){var t;e.preventDefault(),i.dispatchEvent(eb),F((t=function(e){let t=e.deltaMode,i={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100}return e.ctrlKey&&!T&&(i.deltaY*=10),i}(e)).clientX,t.clientY),t.deltaY<0?B(_(t.deltaY)):t.deltaY>0&&R(_(t.deltaY)),i.update(),i.dispatchEvent(eA)}}function Z(e){"Control"===e.key&&(T=!1,i.domElement.getRootNode().removeEventListener("keyup",Z,{passive:!0,capture:!0}))}function V(e){!1!==i.enabled&&!1!==i.enablePan&&function(e){let t=!1;switch(e.code){case i.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?S(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):L(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?S(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):L(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?M(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):L(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?M(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):L(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}(e)}function Q(e){switch(q(e),E.length){case 1:switch(i.touches.ONE){case m.QmN.ROTATE:if(!1===i.enableRotate)return;U(e),s=n.TOUCH_ROTATE;break;case m.QmN.PAN:if(!1===i.enablePan)return;j(e),s=n.TOUCH_PAN;break;default:s=n.NONE}break;case 2:switch(i.touches.TWO){case m.QmN.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&H(e),i.enablePan&&j(e),s=n.TOUCH_DOLLY_PAN;break;case m.QmN.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&H(e),i.enableRotate&&U(e),s=n.TOUCH_DOLLY_ROTATE;break;default:s=n.NONE}break;default:s=n.NONE}s!==n.NONE&&i.dispatchEvent(eb)}function W(e){!1!==i.enabled&&e.preventDefault()}function q(e){let t=P[e.pointerId];void 0===t&&(t=new m.FM8,P[e.pointerId]=t),t.set(e.pageX,e.pageY)}function J(e){return P[e.pointerId===E[0]?E[1]:E[0]]}i.domElement.addEventListener("contextmenu",W),i.domElement.addEventListener("pointerdown",z),i.domElement.addEventListener("pointercancel",Y),i.domElement.addEventListener("wheel",$,{passive:!1}),i.domElement.getRootNode().addEventListener("keydown",function(e){"Control"===e.key&&(T=!0,i.domElement.getRootNode().addEventListener("keyup",Z,{passive:!0,capture:!0}))},{passive:!0,capture:!0}),this.update()}}let eM=new m.iMs,eS=new m.Pa4,eI=new m.Pa4,eC=new m._fP,eL={X:new m.Pa4(1,0,0),Y:new m.Pa4(0,1,0),Z:new m.Pa4(0,0,1)},eR={type:"change"},eB={type:"mouseDown"},eF={type:"mouseUp",mode:null},eD={type:"objectChange"};class ek extends m.Tme{constructor(e,t){super(),void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";let i=new e4;this._gizmo=i,this.add(i);let n=new e5;this._plane=n,this.add(n);let s=this;function r(e,t){let r=t;Object.defineProperty(s,e,{get:function(){return void 0!==r?r:t},set:function(t){r!==t&&(r=t,n[e]=t,i[e]=t,s.dispatchEvent({type:e+"-changed",value:t}),s.dispatchEvent(eR))}}),s[e]=t,n[e]=t,i[e]=t}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);let o=new m.Pa4,a=new m.Pa4,l=new m._fP,h=new m._fP,c=new m.Pa4,d=new m._fP,u=new m.Pa4,p=new m.Pa4,f=new m.Pa4,g=new m.Pa4;r("worldPosition",o),r("worldPositionStart",a),r("worldQuaternion",l),r("worldQuaternionStart",h),r("cameraPosition",c),r("cameraQuaternion",d),r("pointStart",u),r("pointEnd",p),r("rotationAxis",f),r("rotationAngle",0),r("eye",g),this._offset=new m.Pa4,this._startNorm=new m.Pa4,this._endNorm=new m.Pa4,this._cameraScale=new m.Pa4,this._parentPosition=new m.Pa4,this._parentQuaternion=new m._fP,this._parentQuaternionInv=new m._fP,this._parentScale=new m.Pa4,this._worldScaleStart=new m.Pa4,this._worldQuaternionInv=new m._fP,this._worldScale=new m.Pa4,this._positionStart=new m.Pa4,this._quaternionStart=new m._fP,this._scaleStart=new m.Pa4,this._getPointer=eO.bind(this),this._onPointerDown=ej.bind(this),this._onPointerHover=eU.bind(this),this._onPointerMove=eH.bind(this),this._onPointerUp=eN.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;eM.setFromCamera(e,this.camera);let t=eG(this._gizmo.picker[this.mode],eM);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){eM.setFromCamera(e,this.camera);let t=eG(this._plane,eM,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,eB.mode=this.mode,this.dispatchEvent(eB)}}pointerMove(e){let t=this.axis,i=this.mode,n=this.object,s=this.space;if("scale"===i?s="local":("E"===t||"XYZE"===t||"XYZ"===t)&&(s="world"),void 0===n||null===t||!1===this.dragging||-1!==e.button)return;eM.setFromCamera(e,this.camera);let r=eG(this._plane,eM,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),"translate"===i)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===s&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===s&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===s&&(n.position.applyQuaternion(eC.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),"world"===s&&(n.parent&&n.position.add(eS.setFromMatrixPosition(n.parent.matrixWorld)),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(eS.setFromMatrixPosition(n.parent.matrixWorld))));else if("scale"===i){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();0>this.pointEnd.dot(this.pointStart)&&(e*=-1),eI.set(e,e,e)}else eS.copy(this.pointStart),eI.copy(this.pointEnd),eS.applyQuaternion(this._worldQuaternionInv),eI.applyQuaternion(this._worldQuaternionInv),eI.divide(eS),-1===t.search("X")&&(eI.x=1),-1===t.search("Y")&&(eI.y=1),-1===t.search("Z")&&(eI.z=1);n.scale.copy(this._scaleStart).multiply(eI),this.scaleSnap&&(-1!==t.search("X")&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===i){this._offset.copy(this.pointEnd).sub(this.pointStart);let e=20/this.worldPosition.distanceTo(eS.setFromMatrixPosition(this.camera.matrixWorld)),i=!1;"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(eS.copy(this.rotationAxis).cross(this.eye))*e):("X"===t||"Y"===t||"Z"===t)&&(this.rotationAxis.copy(eL[t]),eS.copy(eL[t]),"local"===s&&eS.applyQuaternion(this.worldQuaternion),eS.cross(this.eye),0===eS.length()?i=!0:this.rotationAngle=this._offset.dot(eS.normalize())*e),("E"===t||i)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=0>this._endNorm.cross(this._startNorm).dot(this.eye)?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===s&&"E"!==t&&"XYZE"!==t?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(eC.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(eC.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(eR),this.dispatchEvent(eD)}}pointerUp(e){0===e.button&&(this.dragging&&null!==this.axis&&(eF.mode=this.mode,this.dispatchEvent(eF)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(eR),this.dispatchEvent(eD),this.pointStart.copy(this.pointEnd))}getRaycaster(){return eM}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function eO(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{let t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function eU(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function ej(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function eH(e){this.enabled&&this.pointerMove(this._getPointer(e))}function eN(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function eG(e,t,i){let n=t.intersectObject(e,!0);for(let e=0;e<n.length;e++)if(n[e].object.visible||i)return n[e];return!1}let eK=new m.USm,ez=new m.Pa4(0,1,0),eX=new m.Pa4(0,0,0),eY=new m.yGw,e$=new m._fP,eZ=new m._fP,eV=new m.Pa4,eQ=new m.yGw,eW=new m.Pa4(1,0,0),eq=new m.Pa4(0,1,0),eJ=new m.Pa4(0,0,1),e0=new m.Pa4,e1=new m.Pa4,e2=new m.Pa4;class e4 extends m.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";let e=new m.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new m.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;let n=t.clone();n.opacity=.5;let s=e.clone();s.color.setHex(16711680);let r=e.clone();r.color.setHex(65280);let o=e.clone();o.color.setHex(255);let a=e.clone();a.color.setHex(16711680),a.opacity=.5;let l=e.clone();l.color.setHex(65280),l.opacity=.5;let h=e.clone();h.color.setHex(255),h.opacity=.5;let c=e.clone();c.opacity=.25;let d=e.clone();d.color.setHex(16776960),d.opacity=.25,e.clone().color.setHex(16776960);let u=e.clone();u.color.setHex(7895160);let p=new m.fHI(0,.04,.1,12);p.translate(0,.05,0);let f=new m.DvJ(.08,.08,.08);f.translate(0,.04,0);let g=new m.u9r;g.setAttribute("position",new m.a$l([0,0,0,1,0,0],3));let y=new m.fHI(.0075,.0075,.5,3);function w(e,t){let i=new m.XvJ(e,.0075,3,64,t*Math.PI*2);return i.rotateY(Math.PI/2),i.rotateX(Math.PI/2),i}y.translate(0,.25,0);let x={X:[[new m.Kj0(p,s),[.5,0,0],[0,0,-Math.PI/2]],[new m.Kj0(p,s),[-.5,0,0],[0,0,Math.PI/2]],[new m.Kj0(y,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new m.Kj0(p,r),[0,.5,0]],[new m.Kj0(p,r),[0,-.5,0],[Math.PI,0,0]],[new m.Kj0(y,r)]],Z:[[new m.Kj0(p,o),[0,0,.5],[Math.PI/2,0,0]],[new m.Kj0(p,o),[0,0,-.5],[-Math.PI/2,0,0]],[new m.Kj0(y,o),null,[Math.PI/2,0,0]]],XYZ:[[new m.Kj0(new m.pQR(.1,0),c.clone()),[0,0,0]]],XY:[[new m.Kj0(new m.DvJ(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new m.Kj0(new m.DvJ(.15,.15,.01),a.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new m.Kj0(new m.DvJ(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},v={X:[[new m.Kj0(new m.fHI(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new m.Kj0(new m.fHI(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new m.Kj0(new m.fHI(.2,0,.6,4),i),[0,.3,0]],[new m.Kj0(new m.fHI(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new m.Kj0(new m.fHI(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new m.Kj0(new m.fHI(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new m.Kj0(new m.pQR(.2,0),i)]],XY:[[new m.Kj0(new m.DvJ(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new m.Kj0(new m.DvJ(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new m.Kj0(new m.DvJ(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},b={START:[[new m.Kj0(new m.pQR(.01,2),n),null,null,null,"helper"]],END:[[new m.Kj0(new m.pQR(.01,2),n),null,null,null,"helper"]],DELTA:[[new m.x12(function(){let e=new m.u9r;return e.setAttribute("position",new m.a$l([0,0,0,1,1,1],3)),e}(),n),null,null,null,"helper"]],X:[[new m.x12(g,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new m.x12(g,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new m.x12(g,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},A={XYZE:[[new m.Kj0(w(.5,1),u),null,[0,Math.PI/2,0]]],X:[[new m.Kj0(w(.5,.5),s)]],Y:[[new m.Kj0(w(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new m.Kj0(w(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new m.Kj0(w(.75,1),d),null,[0,Math.PI/2,0]]]},E={AXIS:[[new m.x12(g,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},P={XYZE:[[new m.Kj0(new m.xo$(.25,10,8),i)]],X:[[new m.Kj0(new m.XvJ(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new m.Kj0(new m.XvJ(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new m.Kj0(new m.XvJ(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new m.Kj0(new m.XvJ(.75,.1,2,24),i)]]},T={X:[[new m.Kj0(f,s),[.5,0,0],[0,0,-Math.PI/2]],[new m.Kj0(y,s),[0,0,0],[0,0,-Math.PI/2]],[new m.Kj0(f,s),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new m.Kj0(f,r),[0,.5,0]],[new m.Kj0(y,r)],[new m.Kj0(f,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new m.Kj0(f,o),[0,0,.5],[Math.PI/2,0,0]],[new m.Kj0(y,o),[0,0,0],[Math.PI/2,0,0]],[new m.Kj0(f,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new m.Kj0(new m.DvJ(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new m.Kj0(new m.DvJ(.15,.15,.01),a),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new m.Kj0(new m.DvJ(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new m.Kj0(new m.DvJ(.1,.1,.1),c.clone())]]},_={X:[[new m.Kj0(new m.fHI(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new m.Kj0(new m.fHI(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new m.Kj0(new m.fHI(.2,0,.6,4),i),[0,.3,0]],[new m.Kj0(new m.fHI(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new m.Kj0(new m.fHI(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new m.Kj0(new m.fHI(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new m.Kj0(new m.DvJ(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new m.Kj0(new m.DvJ(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new m.Kj0(new m.DvJ(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new m.Kj0(new m.DvJ(.2,.2,.2),i),[0,0,0]]]},M={X:[[new m.x12(g,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new m.x12(g,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new m.x12(g,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function S(e){let t=new m.Tme;for(let i in e)for(let n=e[i].length;n--;){let s=e[i][n][0].clone(),r=e[i][n][1],o=e[i][n][2],a=e[i][n][3],l=e[i][n][4];s.name=i,s.tag=l,r&&s.position.set(r[0],r[1],r[2]),o&&s.rotation.set(o[0],o[1],o[2]),a&&s.scale.set(a[0],a[1],a[2]),s.updateMatrix();let h=s.geometry.clone();h.applyMatrix4(s.matrix),s.geometry=h,s.renderOrder=1/0,s.position.set(0,0,0),s.rotation.set(0,0,0),s.scale.set(1,1,1),t.add(s)}return t}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=S(x)),this.add(this.gizmo.rotate=S(A)),this.add(this.gizmo.scale=S(T)),this.add(this.picker.translate=S(v)),this.add(this.picker.rotate=S(P)),this.add(this.picker.scale=S(_)),this.add(this.helper.translate=S(b)),this.add(this.helper.rotate=S(E)),this.add(this.helper.scale=S(M)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){let t="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:eZ;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let i=[];i=(i=(i=i.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(let e=0;e<i.length;e++){let n;let s=i[e];if(s.visible=!0,s.rotation.set(0,0,0),s.position.copy(this.worldPosition),n=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),s.scale.set(1,1,1).multiplyScalar(n*this.size/4),"helper"===s.tag){s.visible=!1,"AXIS"===s.name?(s.visible=!!this.axis,"X"===this.axis&&(eC.setFromEuler(eK.set(0,0,0)),s.quaternion.copy(t).multiply(eC),Math.abs(ez.copy(eW).applyQuaternion(t).dot(this.eye))>.9&&(s.visible=!1)),"Y"===this.axis&&(eC.setFromEuler(eK.set(0,0,Math.PI/2)),s.quaternion.copy(t).multiply(eC),Math.abs(ez.copy(eq).applyQuaternion(t).dot(this.eye))>.9&&(s.visible=!1)),"Z"===this.axis&&(eC.setFromEuler(eK.set(0,Math.PI/2,0)),s.quaternion.copy(t).multiply(eC),Math.abs(ez.copy(eJ).applyQuaternion(t).dot(this.eye))>.9&&(s.visible=!1)),"XYZE"===this.axis&&(eC.setFromEuler(eK.set(0,Math.PI/2,0)),ez.copy(this.rotationAxis),s.quaternion.setFromRotationMatrix(eY.lookAt(eX,ez,eq)),s.quaternion.multiply(eC),s.visible=this.dragging),"E"===this.axis&&(s.visible=!1)):"START"===s.name?(s.position.copy(this.worldPositionStart),s.visible=this.dragging):"END"===s.name?(s.position.copy(this.worldPosition),s.visible=this.dragging):"DELTA"===s.name?(s.position.copy(this.worldPositionStart),s.quaternion.copy(this.worldQuaternionStart),eS.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),eS.applyQuaternion(this.worldQuaternionStart.clone().invert()),s.scale.copy(eS),s.visible=this.dragging):(s.quaternion.copy(t),this.dragging?s.position.copy(this.worldPositionStart):s.position.copy(this.worldPosition),this.axis&&(s.visible=-1!==this.axis.search(s.name)));continue}s.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode?("X"===s.name&&Math.abs(ez.copy(eW).applyQuaternion(t).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),"Y"===s.name&&Math.abs(ez.copy(eq).applyQuaternion(t).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),"Z"===s.name&&Math.abs(ez.copy(eJ).applyQuaternion(t).dot(this.eye))>.99&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),"XY"===s.name&&.2>Math.abs(ez.copy(eJ).applyQuaternion(t).dot(this.eye))&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),"YZ"===s.name&&.2>Math.abs(ez.copy(eW).applyQuaternion(t).dot(this.eye))&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1),"XZ"===s.name&&.2>Math.abs(ez.copy(eq).applyQuaternion(t).dot(this.eye))&&(s.scale.set(1e-10,1e-10,1e-10),s.visible=!1)):"rotate"===this.mode&&(e$.copy(t),ez.copy(this.eye).applyQuaternion(eC.copy(t).invert()),-1!==s.name.search("E")&&s.quaternion.setFromRotationMatrix(eY.lookAt(this.eye,eX,eq)),"X"===s.name&&(eC.setFromAxisAngle(eW,Math.atan2(-ez.y,ez.z)),eC.multiplyQuaternions(e$,eC),s.quaternion.copy(eC)),"Y"===s.name&&(eC.setFromAxisAngle(eq,Math.atan2(ez.x,ez.z)),eC.multiplyQuaternions(e$,eC),s.quaternion.copy(eC)),"Z"===s.name&&(eC.setFromAxisAngle(eJ,Math.atan2(ez.y,ez.x)),eC.multiplyQuaternions(e$,eC),s.quaternion.copy(eC))),s.visible=s.visible&&(-1===s.name.indexOf("X")||this.showX),s.visible=s.visible&&(-1===s.name.indexOf("Y")||this.showY),s.visible=s.visible&&(-1===s.name.indexOf("Z")||this.showZ),s.visible=s.visible&&(-1===s.name.indexOf("E")||this.showX&&this.showY&&this.showZ),s.material._color=s.material._color||s.material.color.clone(),s.material._opacity=s.material._opacity||s.material.opacity,s.material.color.copy(s.material._color),s.material.opacity=s.material._opacity,this.enabled&&this.axis&&(s.name===this.axis?(s.material.color.setHex(16776960),s.material.opacity=1):this.axis.split("").some(function(e){return s.name===e})&&(s.material.color.setHex(16776960),s.material.opacity=1))}super.updateMatrixWorld(e)}}class e5 extends m.Kj0{constructor(){super(new m._12(1e5,1e5,2,2),new m.vBJ({visible:!1,wireframe:!0,side:m.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),e0.copy(eW).applyQuaternion("local"===t?this.worldQuaternion:eZ),e1.copy(eq).applyQuaternion("local"===t?this.worldQuaternion:eZ),e2.copy(eJ).applyQuaternion("local"===t?this.worldQuaternion:eZ),ez.copy(e1),this.mode){case"translate":case"scale":switch(this.axis){case"X":ez.copy(this.eye).cross(e0),eV.copy(e0).cross(ez);break;case"Y":ez.copy(this.eye).cross(e1),eV.copy(e1).cross(ez);break;case"Z":ez.copy(this.eye).cross(e2),eV.copy(e2).cross(ez);break;case"XY":eV.copy(e2);break;case"YZ":eV.copy(e0);break;case"XZ":ez.copy(e2),eV.copy(e1);break;case"XYZ":case"E":eV.set(0,0,0)}break;default:eV.set(0,0,0)}0===eV.length()?this.quaternion.copy(this.cameraQuaternion):(eQ.lookAt(eS.set(0,0,0),eV,ez),this.quaternion.setFromRotationMatrix(eQ)),super.updateMatrixWorld(e)}}function e3(e,t,i){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(i.ray.origin),e.object=t,e.distance<i.near||e.distance>i.far)?null:e}let e6=Symbol("SKIP_GENERATION");function e8(e){return(e.index?e.index.count:e.attributes.position.count)/3}function e7(e){let t=e8(e),i=e.drawRange,n=i.start/3,s=(i.start+i.count)/3,r=Math.max(0,n);return[{offset:Math.floor(r),count:Math.floor(Math.min(t,s)-r)}]}function e9(e){if(!e.groups||!e.groups.length)return e7(e);let t=[],i=new Set,n=e.drawRange,s=n.start/3,r=(n.start+n.count)/3;for(let t of e.groups){let e=t.start/3,n=(t.start+t.count)/3;i.add(Math.max(s,e)),i.add(Math.min(r,n))}let o=Array.from(i.values()).sort((e,t)=>e-t);for(let e=0;e<o.length-1;e++){let i=o[e],n=o[e+1];t.push({offset:Math.floor(i),count:Math.floor(n-i)})}return t}function te(e,t,i,n,s){let r=1/0,o=1/0,a=1/0,l=-1/0,h=-1/0,c=-1/0,d=1/0,u=1/0,p=1/0,m=-1/0,f=-1/0,g=-1/0;for(let n=6*t,s=(t+i)*6;n<s;n+=6){let t=e[n+0],i=e[n+1],s=t-i,y=t+i;s<r&&(r=s),y>l&&(l=y),t<d&&(d=t),t>m&&(m=t);let w=e[n+2],x=e[n+3],v=w-x,b=w+x;v<o&&(o=v),b>h&&(h=b),w<u&&(u=w),w>f&&(f=w);let A=e[n+4],E=e[n+5],P=A-E,T=A+E;P<a&&(a=P),T>c&&(c=T),A<p&&(p=A),A>g&&(g=A)}n[0]=r,n[1]=o,n[2]=a,n[3]=l,n[4]=h,n[5]=c,s[0]=d,s[1]=u,s[2]=p,s[3]=m,s[4]=f,s[5]=g}function tt(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function ti(e){let t=-1,i=-1/0;for(let n=0;n<3;n++){let s=e[n+3]-e[n];s>i&&(i=s,t=n)}return t}function tn(e,t,i){let n,s;for(let r=0;r<3;r++){let o=r+3;n=e[r],s=t[r],i[r]=n<s?n:s,n=e[o],s=t[o],i[o]=n>s?n:s}}function ts(e,t,i){for(let n=0;n<3;n++){let s=t[e+2*n],r=t[e+2*n+1],o=s-r,a=s+r;o<i[n]&&(i[n]=o),a>i[n+3]&&(i[n+3]=a)}}function tr(e){let t=e[3]-e[0],i=e[4]-e[1],n=e[5]-e[2];return 2*(t*i+i*n+n*t)}let to=(e,t)=>e.candidate-t.candidate,ta=Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),tl=new Float32Array(6);class th{constructor(){this.boundingData=new Float32Array(6)}}function tc(e,t,i,n,s,r){let o=n,a=n+s-1,l=r.pos,h=2*r.axis;for(;;){for(;o<=a&&i[6*o+h]<l;)o++;for(;o<=a&&i[6*a+h]>=l;)a--;if(!(o<a))return o;for(let e=0;e<3;e++){let i=t[3*o+e];t[3*o+e]=t[3*a+e],t[3*a+e]=i}for(let e=0;e<6;e++){let t=i[6*o+e];i[6*o+e]=i[6*a+e],i[6*a+e]=t}o++,a--}}function td(e,t,i,n,s,r){let o=n,a=n+s-1,l=r.pos,h=2*r.axis;for(;;){for(;o<=a&&i[6*o+h]<l;)o++;for(;o<=a&&i[6*a+h]>=l;)a--;if(!(o<a))return o;{let t=e[o];e[o]=e[a],e[a]=t;for(let e=0;e<6;e++){let t=i[6*o+e];i[6*o+e]=i[6*a+e],i[6*a+e]=t}o++,a--}}}function tu(e,t){return 65535===t[e+15]}function tp(e,t){return t[e+14]}class tm{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,n=-1/0;for(let s=0,r=e.length;s<r;s++){let r=e[s][t];i=r<i?r:i,n=r>n?r:n}this.min=i,this.max=n}setFromPoints(e,t){let i=1/0,n=-1/0;for(let s=0,r=t.length;s<r;s++){let r=t[s],o=e.dot(r);i=o<i?o:i,n=o>n?o:n}this.min=i,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}}tm.prototype.setFromBox=function(){let e=new m.Pa4;return function(t,i){let n=i.min,s=i.max,r=1/0,o=-1/0;for(let i=0;i<=1;i++)for(let a=0;a<=1;a++)for(let l=0;l<=1;l++){e.x=n.x*i+s.x*(1-i),e.y=n.y*a+s.y*(1-a),e.z=n.z*l+s.z*(1-l);let h=t.dot(e);r=Math.min(h,r),o=Math.max(h,o)}this.min=r,this.max=o}}(),new tm;let tf=function(){let e=new m.Pa4,t=new m.Pa4,i=new m.Pa4;return function(n,s,r){let o,a;let l=n.start,h=s.start;i.subVectors(l,h),e.subVectors(n.end,n.start),t.subVectors(s.end,s.start);let c=i.dot(t),d=t.dot(e),u=t.dot(t),p=i.dot(e),m=e.dot(e)*u-d*d;o=0!==m?(c*d-p*u)/m:0,a=(c+o*d)/u,r.x=o,r.y=a}}(),tg=function(){let e=new m.FM8,t=new m.Pa4,i=new m.Pa4;return function(n,s,r,o){tf(n,s,e);let a=e.x,l=e.y;if(a>=0&&a<=1&&l>=0&&l<=1){n.at(a,r),s.at(l,o);return}if(a>=0&&a<=1){l<0?s.at(0,o):s.at(1,o),n.closestPointToPoint(o,!0,r);return}if(l>=0&&l<=1){a<0?n.at(0,r):n.at(1,r),s.closestPointToPoint(r,!0,o);return}{let e,h;if(e=a<0?n.start:n.end,h=l<0?s.start:s.end,n.closestPointToPoint(h,!0,t),s.closestPointToPoint(e,!0,i),t.distanceToSquared(h)<=i.distanceToSquared(e)){r.copy(t),o.copy(h);return}r.copy(e),o.copy(i);return}}}(),ty=function(){let e=new m.Pa4,t=new m.Pa4,i=new m.JOQ,n=new m.Zzh;return function(s,r){let{radius:o,center:a}=s,{a:l,b:h,c}=r;if(n.start=l,n.end=h,n.closestPointToPoint(a,!0,e).distanceTo(a)<=o||(n.start=l,n.end=c,n.closestPointToPoint(a,!0,e).distanceTo(a)<=o)||(n.start=h,n.end=c,n.closestPointToPoint(a,!0,e).distanceTo(a)<=o))return!0;let d=r.getPlane(i);if(Math.abs(d.distanceToPoint(a))<=o){let e=d.projectPoint(a,t);if(r.containsPoint(e))return!0}return!1}}();function tw(e){return 1e-15>Math.abs(e)}class tx extends m.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=[,,,,].fill().map(()=>new m.Pa4),this.satBounds=[,,,,].fill().map(()=>new tm),this.points=[this.a,this.b,this.c],this.sphere=new m.aLr,this.plane=new m.JOQ,this.needsUpdate=!0}intersectsSphere(e){return ty(e,this)}update(){let e=this.a,t=this.b,i=this.c,n=this.points,s=this.satAxes,r=this.satBounds,o=s[0],a=r[0];this.getNormal(o),a.setFromPoints(o,n);let l=s[1],h=r[1];l.subVectors(e,t),h.setFromPoints(l,n);let c=s[2],d=r[2];c.subVectors(t,i),d.setFromPoints(c,n);let u=s[3],p=r[3];u.subVectors(i,e),p.setFromPoints(u,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}tx.prototype.closestPointToSegment=function(){let e=new m.Pa4,t=new m.Pa4,i=new m.Zzh;return function(n,s=null,r=null){let o;let{start:a,end:l}=n,h=this.points,c=1/0;for(let a=0;a<3;a++){let l=(a+1)%3;i.start.copy(h[a]),i.end.copy(h[l]),tg(i,n,e,t),(o=e.distanceToSquared(t))<c&&(c=o,s&&s.copy(e),r&&r.copy(t))}return this.closestPointToPoint(a,e),(o=a.distanceToSquared(e))<c&&(c=o,s&&s.copy(e),r&&r.copy(a)),this.closestPointToPoint(l,e),(o=l.distanceToSquared(e))<c&&(c=o,s&&s.copy(e),r&&r.copy(l)),Math.sqrt(c)}}(),tx.prototype.intersectsTriangle=function(){let e=new tx,t=[,,,],i=[,,,],n=new tm,s=new tm,r=new m.Pa4,o=new m.Pa4,a=new m.Pa4,l=new m.Pa4,h=new m.Pa4,c=new m.Zzh,d=new m.Zzh,u=new m.Zzh,p=new m.Pa4;function f(e,t,i){let n=e.points,s=0,r=-1;for(let e=0;e<3;e++){let{start:a,end:l}=c;a.copy(n[e]),l.copy(n[(e+1)%3]),c.delta(o);let h=tw(t.distanceToPoint(a));if(tw(t.normal.dot(o))&&h){i.copy(c),s=2;break}let d=t.intersectLine(c,p);if(!d&&h&&p.copy(a),(d||h)&&!tw(p.distanceTo(l))){if(s<=1)(1===s?i.start:i.end).copy(p),h&&(r=s);else if(s>=2){(1===r?i.start:i.end).copy(p),s=2;break}if(2==++s&&-1===r)break}}return s}return function(o,c=null,p=!1){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(e.copy(o),e.update(),o=e);let m=this.plane,g=o.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let e=this.satBounds,a=this.satAxes;i[0]=o.a,i[1]=o.b,i[2]=o.c;for(let t=0;t<4;t++){let s=e[t],r=a[t];if(n.setFromPoints(r,i),s.isSeparated(n))return!1}let l=o.satBounds,h=o.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){let i=l[e],s=h[e];if(n.setFromPoints(s,t),i.isSeparated(n))return!1}for(let e=0;e<4;e++){let o=a[e];for(let e=0;e<4;e++){let a=h[e];if(r.crossVectors(o,a),n.setFromPoints(r,t),s.setFromPoints(r,i),n.isSeparated(s))return!1}}return c&&(p||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),c.start.set(0,0,0),c.end.set(0,0,0)),!0}{let e=f(this,g,d);if(1===e&&o.containsPoint(d.end))return c&&(c.start.copy(d.end),c.end.copy(d.end)),!0;if(2!==e)return!1;let t=f(o,m,u);if(1===t&&this.containsPoint(u.end))return c&&(c.start.copy(u.end),c.end.copy(u.end)),!0;if(2!==t)return!1;if(d.delta(a),u.delta(l),0>a.dot(l)){let e=u.start;u.start=u.end,u.end=e}let i=d.start.dot(a),n=d.end.dot(a),s=u.start.dot(a),r=u.end.dot(a);return(i===r||s===n||n<s!=i<r)&&(c&&(h.subVectors(d.start,u.start),h.dot(a)>0?c.start.copy(d.start):c.start.copy(u.start),h.subVectors(d.end,u.end),0>h.dot(a)?c.end.copy(d.end):c.end.copy(u.end)),!0)}}}(),tx.prototype.distanceToPoint=function(){let e=new m.Pa4;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),tx.prototype.distanceToTriangle=function(){let e=new m.Pa4,t=new m.Pa4,i=["a","b","c"],n=new m.Zzh,s=new m.Zzh;return function(r,o=null,a=null){let l=o||a?n:null;if(this.intersectsTriangle(r,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let h=1/0;for(let t=0;t<3;t++){let n;let s=i[t],l=r[s];this.closestPointToPoint(l,e),(n=l.distanceToSquared(e))<h&&(h=n,o&&o.copy(e),a&&a.copy(l));let c=this[s];r.closestPointToPoint(c,e),(n=c.distanceToSquared(e))<h&&(h=n,o&&o.copy(c),a&&a.copy(e))}for(let l=0;l<3;l++){let c=i[l],d=i[(l+1)%3];n.set(this[c],this[d]);for(let l=0;l<3;l++){let c=i[l],d=i[(l+1)%3];s.set(r[c],r[d]),tg(n,s,e,t);let u=e.distanceToSquared(t);u<h&&(h=u,o&&o.copy(e),a&&a.copy(t))}}return Math.sqrt(h)}}();class tv{constructor(e,t,i){this.isOrientedBox=!0,this.min=new m.Pa4,this.max=new m.Pa4,this.matrix=new m.yGw,this.invMatrix=new m.yGw,this.points=Array(8).fill().map(()=>new m.Pa4),this.satAxes=[,,,].fill().map(()=>new m.Pa4),this.satBounds=[,,,].fill().map(()=>new tm),this.alignedSatBounds=[,,,].fill().map(()=>new tm),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}tv.prototype.update=function(){let e=this.matrix,t=this.min,i=this.max,n=this.points;for(let s=0;s<=1;s++)for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){let a=n[1*s|2*r|4*o];a.x=s?i.x:t.x,a.y=r?i.y:t.y,a.z=o?i.z:t.z,a.applyMatrix4(e)}let s=this.satBounds,r=this.satAxes,o=n[0];for(let e=0;e<3;e++){let t=r[e],i=s[e],a=n[1<<e];t.subVectors(o,a),i.setFromPoints(t,n)}let a=this.alignedSatBounds;a[0].setFromPointsField(n,"x"),a[1].setFromPointsField(n,"y"),a[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},tv.prototype.intersectsBox=function(){let e=new tm;return function(t){this.needsUpdate&&this.update();let i=t.min,n=t.max,s=this.satBounds,r=this.satAxes,o=this.alignedSatBounds;if(e.min=i.x,e.max=n.x,o[0].isSeparated(e)||(e.min=i.y,e.max=n.y,o[1].isSeparated(e))||(e.min=i.z,e.max=n.z,o[2].isSeparated(e)))return!1;for(let i=0;i<3;i++){let n=r[i],o=s[i];if(e.setFromBox(n,t),o.isSeparated(e))return!1}return!0}}(),tv.prototype.intersectsTriangle=function(){let e=new tx,t=[,,,],i=new tm,n=new tm,s=new m.Pa4;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(e.copy(r),e.update(),r=e);let o=this.satBounds,a=this.satAxes;t[0]=r.a,t[1]=r.b,t[2]=r.c;for(let e=0;e<3;e++){let n=o[e],s=a[e];if(i.setFromPoints(s,t),n.isSeparated(i))return!1}let l=r.satBounds,h=r.satAxes,c=this.points;for(let e=0;e<3;e++){let t=l[e],n=h[e];if(i.setFromPoints(n,c),t.isSeparated(i))return!1}for(let e=0;e<3;e++){let r=a[e];for(let e=0;e<4;e++){let o=h[e];if(s.crossVectors(r,o),i.setFromPoints(s,t),n.setFromPoints(s,c),i.isSeparated(n))return!1}}return!0}}(),tv.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},tv.prototype.distanceToPoint=function(){let e=new m.Pa4;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),tv.prototype.distanceToBox=function(){let e=["x","y","z"],t=Array(12).fill().map(()=>new m.Zzh),i=Array(12).fill().map(()=>new m.Zzh),n=new m.Pa4,s=new m.Pa4;return function(r,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||l)&&(r.getCenter(s),this.closestPointToPoint(s,n),r.closestPointToPoint(n,s),a&&a.copy(n),l&&l.copy(s)),0;let h=o*o,c=r.min,d=r.max,u=this.points,p=1/0;for(let e=0;e<8;e++){let t=u[e];s.copy(t).clamp(c,d);let i=t.distanceToSquared(s);if(i<p&&(p=i,a&&a.copy(t),l&&l.copy(s),i<h))return Math.sqrt(i)}let m=0;for(let n=0;n<3;n++)for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let o=(n+1)%3,a=(n+2)%3,l=s<<o|r<<a,h=1<<n|s<<o|r<<a,p=u[l],f=u[h];t[m].set(p,f);let g=e[n],y=e[o],w=e[a],x=i[m],v=x.start,b=x.end;v[g]=c[g],v[y]=s?c[y]:d[y],v[w]=r?c[w]:d[y],b[g]=d[g],b[y]=s?c[y]:d[y],b[w]=r?c[w]:d[y],m++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let i=0;i<=1;i++){s.x=e?d.x:c.x,s.y=t?d.y:c.y,s.z=i?d.z:c.z,this.closestPointToPoint(s,n);let r=s.distanceToSquared(n);if(r<p&&(p=r,a&&a.copy(n),l&&l.copy(s),r<h))return Math.sqrt(r)}for(let e=0;e<12;e++){let r=t[e];for(let e=0;e<12;e++){tg(r,i[e],n,s);let t=n.distanceToSquared(s);if(t<p&&(p=t,a&&a.copy(n),l&&l.copy(s),t<h))return Math.sqrt(t)}}return Math.sqrt(p)}}();class tb{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class tA extends tb{constructor(){super(()=>new tx)}}let tE=new tA;class tP{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;let e=[],t=null;this.setBuffer=i=>{t&&e.push(t),t=i,this.float32Array=new Float32Array(i),this.uint16Array=new Uint16Array(i),this.uint32Array=new Uint32Array(i)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==e.length&&this.setBuffer(e.pop())}}}let tT=new tP,t_=[],tM=new tb(()=>new m.ZzF),tS=new m.Pa4,tI=new m.Pa4,tC=new m.Pa4,tL=new m.Pa4,tR=new m.Pa4,tB=new m.FM8,tF=new m.FM8,tD=new m.FM8,tk=new m.Pa4,tO=new m.Pa4,tU=new m.Pa4,tj=new m.Pa4;function tH(e,t,i,n,s){let r=3*n,o=r+0,a=r+1,l=r+2,h=e.index;e.index&&(o=h.getX(o),a=h.getX(a),l=h.getX(l));let{position:c,normal:d,uv:u,uv1:p}=e.attributes,f=function(e,t,i,n,s,r,o,a,l){tC.fromBufferAttribute(t,r),tL.fromBufferAttribute(t,o),tR.fromBufferAttribute(t,a);let h=null===(l===m._Li?e.intersectTriangle(tR,tL,tC,!0,tj):e.intersectTriangle(tC,tL,tR,l!==m.ehD,tj))?null:{distance:e.origin.distanceTo(tj),point:tj.clone()};if(h){n&&(tB.fromBufferAttribute(n,r),tF.fromBufferAttribute(n,o),tD.fromBufferAttribute(n,a),h.uv=m.CJI.getInterpolation(tj,tC,tL,tR,tB,tF,tD,new m.FM8)),s&&(tB.fromBufferAttribute(s,r),tF.fromBufferAttribute(s,o),tD.fromBufferAttribute(s,a),h.uv1=m.CJI.getInterpolation(tj,tC,tL,tR,tB,tF,tD,new m.FM8)),i&&(tk.fromBufferAttribute(i,r),tO.fromBufferAttribute(i,o),tU.fromBufferAttribute(i,a),h.normal=m.CJI.getInterpolation(tj,tC,tL,tR,tk,tO,tU,new m.Pa4),h.normal.dot(e.direction)>0&&h.normal.multiplyScalar(-1));let t={a:r,b:o,c:a,normal:new m.Pa4,materialIndex:0};m.CJI.getNormal(tC,tL,tR,t.normal),h.face=t,h.faceIndex=r}return h}(i,c,d,u,p,o,a,l,t);return f?(f.faceIndex=n,s&&s.push(f),f):null}function tN(e,t,i,n){let s=e.a,r=e.b,o=e.c,a=t,l=t+1,h=t+2;i&&(a=i.getX(a),l=i.getX(l),h=i.getX(h)),s.x=n.getX(a),s.y=n.getY(a),s.z=n.getZ(a),r.x=n.getX(l),r.y=n.getY(l),r.z=n.getZ(l),o.x=n.getX(h),o.y=n.getY(h),o.z=n.getZ(h)}function tG(e,t,i,n,s,r,o){let{geometry:a}=i,{index:l}=a,h=a.attributes.position;for(let i=e,a=t+e;i<a;i++){let e;if(tN(o,3*(e=i),l,h),o.needsUpdate=!0,n(o,e,s,r))return!0}return!1}let tK=new m.ZzF;function tz(e,t,i,n){return tt(e,t,tK),i.intersectBox(tK,n)}let tX=new m.Pa4;function tY(e,t,i,n,s){tT.setBuffer(e._roots[t]),function e(t,i,n,s,r){let{float32Array:o,uint16Array:a,uint32Array:l}=tT,h=2*t;if(tu(h,a))!function(e,t,i,n,s,r){let{geometry:o,_indirectBuffer:a}=e;for(let e=n,a=n+s;e<a;e++)tH(o,t,i,e,r)}(i,n,s,l[t+6],tp(h,a),r);else{let a=t+8;tz(a,o,s,tX)&&e(a,i,n,s,r);let h=l[t+6];tz(h,o,s,tX)&&e(h,i,n,s,r)}}(0,e,i,n,s),tT.clearBuffer()}let t$=new m.Pa4,tZ=["x","y","z"];function tV(e,t,i,n){tT.setBuffer(e._roots[t]);let s=function e(t,i,n,s){let{float32Array:r,uint16Array:o,uint32Array:a}=tT,l=2*t;if(tu(l,o))return function(e,t,i,n,s){let{geometry:r,_indirectBuffer:o}=e,a=1/0,l=null;for(let e=n,o=n+s;e<o;e++){let n;(n=tH(r,t,i,e))&&n.distance<a&&(l=n,a=n.distance)}return l}(i,n,s,a[t+6],tp(l,o));{let o,l;let h=a[t+7],c=tZ[h],d=s.direction[c]>=0;d?(o=t+8,l=a[t+6]):(o=a[t+6],l=t+8);let u=tz(o,r,s,t$)?e(o,i,n,s):null;if(u){let e=u.point[c];if(d?e<=r[l+h]:e>=r[l+h+3])return u}let p=tz(l,r,s,t$)?e(l,i,n,s):null;return u&&p?u.distance<=p.distance?u:p:u||p||null}}(0,e,i,n);return tT.clearBuffer(),s}let tQ=new m.ZzF,tW=new tx,tq=new tx,tJ=new m.yGw,t0=new tv,t1=new tv;function t2(e,t,i,n){tT.setBuffer(e._roots[t]);let s=function e(t,i,n,s,r=null){let{float32Array:o,uint16Array:a,uint32Array:l}=tT,h=2*t;if(null===r&&(n.boundingBox||n.computeBoundingBox(),t0.set(n.boundingBox.min,n.boundingBox.max,s),r=t0),tu(h,a)){let e=i.geometry,r=e.index,c=e.attributes.position,d=n.index,u=n.attributes.position,p=l[t+6],m=tp(h,a);if(tJ.copy(s).invert(),n.boundsTree)return tt(t,o,t1),t1.matrix.copy(tJ),t1.needsUpdate=!0,n.boundsTree.shapecast({intersectsBounds:e=>t1.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(s),e.b.applyMatrix4(s),e.c.applyMatrix4(s),e.needsUpdate=!0;for(let t=3*p,i=(m+p)*3;t<i;t+=3)if(tN(tq,t,r,c),tq.needsUpdate=!0,e.intersectsTriangle(tq))return!0;return!1}});for(let e=3*p,t=(m+p)*3;e<t;e+=3){tN(tW,e,r,c),tW.a.applyMatrix4(tJ),tW.b.applyMatrix4(tJ),tW.c.applyMatrix4(tJ),tW.needsUpdate=!0;for(let e=0,t=d.count;e<t;e+=3)if(tN(tq,e,d,u),tq.needsUpdate=!0,tW.intersectsTriangle(tq))return!0}}else{let a=t+8,h=l[t+6];return tt(a,o,tQ),!!(r.intersectsBox(tQ)&&e(a,i,n,s,r))||(tt(h,o,tQ),!!(r.intersectsBox(tQ)&&e(h,i,n,s,r)))}}(0,e,i,n);return tT.clearBuffer(),s}let t4=new m.yGw,t5=new tv,t3=new tv,t6=new m.Pa4,t8=new m.Pa4,t7=new m.Pa4,t9=new m.Pa4;function ie(e,t,i,n,s,r,o){let{geometry:a}=i,{index:l}=a,h=a.attributes.position;for(let a=e,c=t+e;a<c;a++){let e;if(tN(o,3*(e=i.resolveTriangleIndex(a)),l,h),o.needsUpdate=!0,n(o,e,s,r))return!0}return!1}let it=new m.Pa4;function ii(e,t,i,n,s){tT.setBuffer(e._roots[t]),function e(t,i,n,s,r){let{float32Array:o,uint16Array:a,uint32Array:l}=tT,h=2*t;if(tu(h,a))!function(e,t,i,n,s,r){let{geometry:o,_indirectBuffer:a}=e;for(let e=n,l=n+s;e<l;e++)tH(o,t,i,a?a[e]:e,r)}(i,n,s,l[t+6],tp(h,a),r);else{let a=t+8;tz(a,o,s,it)&&e(a,i,n,s,r);let h=l[t+6];tz(h,o,s,it)&&e(h,i,n,s,r)}}(0,e,i,n,s),tT.clearBuffer()}let is=new m.Pa4,ir=["x","y","z"];function io(e,t,i,n){tT.setBuffer(e._roots[t]);let s=function e(t,i,n,s){let{float32Array:r,uint16Array:o,uint32Array:a}=tT,l=2*t;if(tu(l,o))return function(e,t,i,n,s){let{geometry:r,_indirectBuffer:o}=e,a=1/0,l=null;for(let e=n,h=n+s;e<h;e++){let n;(n=tH(r,t,i,o?o[e]:e))&&n.distance<a&&(l=n,a=n.distance)}return l}(i,n,s,a[t+6],tp(l,o));{let o,l;let h=a[t+7],c=ir[h],d=s.direction[c]>=0;d?(o=t+8,l=a[t+6]):(o=a[t+6],l=t+8);let u=tz(o,r,s,is)?e(o,i,n,s):null;if(u){let e=u.point[c];if(d?e<=r[l+h]:e>=r[l+h+3])return u}let p=tz(l,r,s,is)?e(l,i,n,s):null;return u&&p?u.distance<=p.distance?u:p:u||p||null}}(0,e,i,n);return tT.clearBuffer(),s}let ia=new m.ZzF,il=new tx,ih=new tx,ic=new m.yGw,id=new tv,iu=new tv;function ip(e,t,i,n){tT.setBuffer(e._roots[t]);let s=function e(t,i,n,s,r=null){let{float32Array:o,uint16Array:a,uint32Array:l}=tT,h=2*t;if(null===r&&(n.boundingBox||n.computeBoundingBox(),id.set(n.boundingBox.min,n.boundingBox.max,s),r=id),tu(h,a)){let e=i.geometry,r=e.index,c=e.attributes.position,d=n.index,u=n.attributes.position,p=l[t+6],m=tp(h,a);if(ic.copy(s).invert(),n.boundsTree)return tt(t,o,iu),iu.matrix.copy(ic),iu.needsUpdate=!0,n.boundsTree.shapecast({intersectsBounds:e=>iu.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(s),e.b.applyMatrix4(s),e.c.applyMatrix4(s),e.needsUpdate=!0;for(let t=p,n=m+p;t<n;t++)if(tN(ih,3*i.resolveTriangleIndex(t),r,c),ih.needsUpdate=!0,e.intersectsTriangle(ih))return!0;return!1}});for(let e=p,t=m+p;e<t;e++){tN(il,3*i.resolveTriangleIndex(e),r,c),il.a.applyMatrix4(ic),il.b.applyMatrix4(ic),il.c.applyMatrix4(ic),il.needsUpdate=!0;for(let e=0,t=d.count;e<t;e+=3)if(tN(ih,e,d,u),ih.needsUpdate=!0,il.intersectsTriangle(ih))return!0}}else{let a=t+8,h=l[t+6];return tt(a,o,ia),!!(r.intersectsBox(ia)&&e(a,i,n,s,r))||(tt(h,o,ia),!!(r.intersectsBox(ia)&&e(h,i,n,s,r)))}}(0,e,i,n);return tT.clearBuffer(),s}let im=new m.yGw,ig=new tv,iy=new tv,iw=new m.Pa4,ix=new m.Pa4,iv=new m.Pa4,ib=new m.Pa4,iA=new tT.constructor,iE=new tT.constructor,iP=new tb(()=>new m.ZzF),iT=new m.ZzF,i_=new m.ZzF,iM=new m.ZzF,iS=new m.ZzF,iI=!1,iC=new tv,iL=new m.ZzF,iR={strategy:0,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0};class iB{static serialize(e,t={}){t={cloneBuffers:!0,...t};let i=e.geometry,n=e._roots,s=e._indirectBuffer,r=i.getIndex();return t.cloneBuffers?{roots:n.map(e=>e.slice()),index:r.array.slice(),indirectBuffer:s?s.slice():null}:{roots:n,index:r.array,indirectBuffer:s}}static deserialize(e,t,i={}){i={setIndex:!0,indirect:!!e.indirectBuffer,...i};let{index:n,roots:s,indirectBuffer:r}=e,o=new iB(t,{...i,[e6]:!0});if(o._roots=s,o._indirectBuffer=r||null,i.setIndex){let i=t.getIndex();if(null===i){let i=new m.TlE(e.index,1,!1);t.setIndex(i)}else i.array!==n&&(i.array.set(n),i.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw Error("MeshBVH: Only BufferGeometries are supported.");if((t=Object.assign({...iR,[e6]:!1},t)).useSharedArrayBuffer&&!("undefined"!=typeof SharedArrayBuffer))throw Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[e6]||(function(e,t){let i=e.geometry;t.indirect&&(e._indirectBuffer=function(e,t){let i=(e.index?e.index.count:e.attributes.position.count)/3,n=i>65536,s=n?4:2,r=t?new SharedArrayBuffer(i*s):new ArrayBuffer(i*s),o=n?new Uint32Array(r):new Uint16Array(r);for(let e=0,t=o.length;e<t;e++)o[e]=e;return o}(i,t.useSharedArrayBuffer),function(e){if(0===e.groups.length)return!1;let t=e8(e),i=e9(e).sort((e,t)=>e.offset-t.offset),n=i[i.length-1];n.count=Math.min(t-n.offset,n.count);let s=0;return i.forEach(({count:e})=>s+=e),t!==s}(i)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),e._indirectBuffer||function(e,t){if(!e.index){let i=e.attributes.position.count,n=function(e,t=ArrayBuffer){return e>65535?new Uint32Array(new t(4*e)):new Uint16Array(new t(2*e))}(i,t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);e.setIndex(new m.TlE(n,1));for(let e=0;e<i;e++)n[e]=e}}(i,t);let a=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,l=function(e,t=null,i=null,n=null){let s;let r=e.attributes.position,o=e.index?e.index.array:null,a=e8(e),l=r.normalized;null===t?(s=new Float32Array(24*a),i=0,n=a):(s=t,i=i||0,n=n||a);let h=r.array,c=r.offset||0,d=3;r.isInterleavedBufferAttribute&&(d=r.data.stride);let u=["getX","getY","getZ"];for(let e=i;e<i+n;e++){let t=3*e,i=6*e,n=t+0,a=t+1,p=t+2;o&&(n=o[n],a=o[a],p=o[p]),l||(n=n*d+c,a=a*d+c,p=p*d+c);for(let e=0;e<3;e++){let t,o,c;l?(t=r[u[e]](n),o=r[u[e]](a),c=r[u[e]](p)):(t=h[n+e],o=h[a+e],c=h[p+e]);let d=t;o<d&&(d=o),c<d&&(d=c);let m=t;o>m&&(m=o),c>m&&(m=c);let f=(m-d)/2,g=2*e;s[i+g+0]=d+f,s[i+g+1]=f+(Math.abs(d)+f)*5960464477539063e-23}}return s}(i),h=t.indirect?e7(i):e9(i);e._roots=h.map(i=>{let h=function(e,t,i,n,s){let{maxDepth:r,verbose:o,maxLeafTris:a,strategy:l,onProgress:h,indirect:c}=s,d=e._indirectBuffer,u=e.geometry,p=u.index?u.index.array:null,m=c?td:tc,f=e8(u),g=new Float32Array(6),y=!1,w=new th;return te(t,i,n,w.boundingData,g),function e(i,n,s,h=null,c=0){if(!y&&c>=r&&(y=!0,o&&(console.warn(`MeshBVH: Max depth of ${r} reached when generating BVH. Consider increasing maxDepth.`),console.warn(u))),s<=a||c>=r)return x(n+s),i.offset=n,i.count=s,i;let f=function(e,t,i,n,s,r){let o=-1,a=0;if(0===r)-1!==(o=ti(t))&&(a=(t[o]+t[o+3])/2);else if(1===r)-1!==(o=ti(e))&&(a=function(e,t,i,n){let s=0;for(let r=t,o=t+i;r<o;r++)s+=e[6*r+2*n];return s/i}(i,n,s,o));else if(2===r){let r=tr(e),l=1.25*s,h=6*n,c=(n+s)*6;for(let e=0;e<3;e++){let n=t[e],d=(t[e+3]-n)/32;if(s<8){let t=[...ta];t.length=s;let n=0;for(let s=h;s<c;s+=6,n++){let r=t[n];r.candidate=i[s+2*e],r.count=0;let{bounds:o,leftCacheBounds:a,rightCacheBounds:l}=r;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,a[e]=1/0,a[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0;ts(s,i,o)}t.sort(to);let d=s;for(let e=0;e<d;e++){let i=t[e];for(;e+1<d&&t[e+1].candidate===i.candidate;)t.splice(e+1,1),d--}for(let n=h;n<c;n+=6){let s=i[n+2*e];for(let e=0;e<d;e++){let r=t[e];s>=r.candidate?ts(n,i,r.rightCacheBounds):(ts(n,i,r.leftCacheBounds),r.count++)}}for(let i=0;i<d;i++){let n=t[i],h=n.count,c=s-n.count,d=n.leftCacheBounds,u=n.rightCacheBounds,p=0;0!==h&&(p=tr(d)/r);let m=0;0!==c&&(m=tr(u)/r);let f=1+1.25*(p*h+m*c);f<l&&(o=e,l=f,a=n.candidate)}}else{for(let e=0;e<32;e++){let t=ta[e];t.count=0,t.candidate=n+d+e*d;let i=t.bounds;for(let e=0;e<3;e++)i[e]=1/0,i[e+3]=-1/0}for(let t=h;t<c;t+=6){let s=~~((i[t+2*e]-n)/d);s>=32&&(s=31);let r=ta[s];r.count++,ts(t,i,r.bounds)}let t=ta[31];!function(e,t){t.set(e)}(t.bounds,t.rightCacheBounds);for(let e=30;e>=0;e--){let t=ta[e],i=ta[e+1];tn(t.bounds,i.rightCacheBounds,t.rightCacheBounds)}let u=0;for(let t=0;t<31;t++){let i=ta[t],n=i.count,h=i.bounds,c=ta[t+1].rightCacheBounds;0!==n&&(0===u?function(e,t){t.set(e)}(h,tl):tn(h,tl,tl));let d=0,p=0;0!==(u+=n)&&(d=tr(tl)/r);let m=s-u;0!==m&&(p=tr(c)/r);let f=1+1.25*(d*u+p*m);f<l&&(o=e,l=f,a=i.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:o,pos:a}}(i.boundingData,h,t,n,s,l);if(-1===f.axis)return x(n+s),i.offset=n,i.count=s,i;let w=m(d,p,t,n,s,f);if(w===n||w===n+s)x(n+s),i.offset=n,i.count=s;else{i.splitAxis=f.axis;let r=new th,o=w-n;i.left=r,te(t,n,o,r.boundingData,g),e(r,n,o,g,c+1);let a=new th,l=s-o;i.right=a,te(t,w,l,a.boundingData,g),e(a,w,l,g,c+1)}return i}(w,i,n,g),w;function x(e){h&&h(e/f)}}(e,l,i.offset,i.count,t),c=new a(32*function e(t){return"count"in t?1:1+e(t.left)+e(t.right)}(h));return n=new Float32Array(c),s=new Uint32Array(c),r=new Uint16Array(c),o=new Uint8Array(c),function e(t,i){let a=t/4,l=t/2,h=i.boundingData;for(let e=0;e<6;e++)n[a+e]=h[e];if("count"in i){if(i.buffer){let e=i.buffer;o.set(new Uint8Array(e),t);for(let i=t,n=t+e.byteLength;i<n;i+=32)tu(i/2,r)||(s[i/4+6]+=a);return t+e.byteLength}{let e=i.offset,n=i.count;return s[a+6]=e,r[l+14]=n,r[l+15]=65535,t+32}}{let n;let r=i.left,o=i.right,l=i.splitAxis;if((n=e(t+32,r))/4>4294967296)throw Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return s[a+6]=n/4,n=e(n,o),s[a+7]=l,n}}(0,h),c})}(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new m.ZzF)));let{_indirectBuffer:i}=this;this.resolveTriangleIndex=t.indirect?e=>i[e]:e=>e}refit(e=null){return(this.indirect?function(e,t=null){let i,n,s,r;t&&Array.isArray(t)&&(t=new Set(t));let o=e.geometry,a=o.index?o.index.array:null,l=o.attributes.position,h=0,c=e._roots;for(let o=0,d=c.length;o<d;o++)i=c[o],n=new Uint32Array(i),s=new Uint16Array(i),r=new Float32Array(i),function i(o,h,c=!1){let d=2*o;if(65535===s[d+15]){let t=n[o+6],i=s[d+14],h=1/0,c=1/0,u=1/0,p=-1/0,m=-1/0,f=-1/0;for(let n=t,s=t+i;n<s;n++){let t=3*e.resolveTriangleIndex(n);for(let e=0;e<3;e++){let i=t+e;i=a?a[i]:i;let n=l.getX(i),s=l.getY(i),r=l.getZ(i);n<h&&(h=n),n>p&&(p=n),s<c&&(c=s),s>m&&(m=s),r<u&&(u=r),r>f&&(f=r)}}return(r[o+0]!==h||r[o+1]!==c||r[o+2]!==u||r[o+3]!==p||r[o+4]!==m||r[o+5]!==f)&&(r[o+0]=h,r[o+1]=c,r[o+2]=u,r[o+3]=p,r[o+4]=m,r[o+5]=f,!0)}{let e=o+8,s=n[o+6],a=c,l=!1,d=!1;t?a||(l=t.has(e+h),d=t.has(s+h),a=!l&&!d):(l=!0,d=!0);let u=a||l,p=a||d,m=!1;u&&(m=i(e,h,a));let f=!1;p&&(f=i(s,h,a));let g=m||f;if(g)for(let t=0;t<3;t++){let i=e+t,n=s+t,a=r[i],l=r[i+3],h=r[n],c=r[n+3];r[o+t]=a<h?a:h,r[o+t+3]=l>c?l:c}return g}}(0,h),h+=i.byteLength}:function(e,t=null){let i,n,s,r;t&&Array.isArray(t)&&(t=new Set(t));let o=e.geometry,a=o.index?o.index.array:null,l=o.attributes.position,h=0,c=e._roots;for(let e=0,o=c.length;e<o;e++)i=c[e],n=new Uint32Array(i),s=new Uint16Array(i),r=new Float32Array(i),function e(i,o,h=!1){let c=2*i;if(65535===s[c+15]){let e=n[i+6],t=s[c+14],o=1/0,h=1/0,d=1/0,u=-1/0,p=-1/0,m=-1/0;for(let i=3*e,n=3*(e+t);i<n;i++){let e=a[i],t=l.getX(e),n=l.getY(e),s=l.getZ(e);t<o&&(o=t),t>u&&(u=t),n<h&&(h=n),n>p&&(p=n),s<d&&(d=s),s>m&&(m=s)}return(r[i+0]!==o||r[i+1]!==h||r[i+2]!==d||r[i+3]!==u||r[i+4]!==p||r[i+5]!==m)&&(r[i+0]=o,r[i+1]=h,r[i+2]=d,r[i+3]=u,r[i+4]=p,r[i+5]=m,!0)}{let s=i+8,a=n[i+6],l=h,c=!1,d=!1;t?l||(c=t.has(s+o),d=t.has(a+o),l=!c&&!d):(c=!0,d=!0);let u=l||c,p=l||d,m=!1;u&&(m=e(s,o,l));let f=!1;p&&(f=e(a,o,l));let g=m||f;if(g)for(let e=0;e<3;e++){let t=s+e,n=a+e,o=r[t],l=r[t+3],h=r[n],c=r[n+3];r[i+e]=o<h?o:h,r[i+e+3]=l>c?l:c}return g}}(0,h),h+=i.byteLength})(this,e)}traverse(e,t=0){let i=this._roots[t],n=new Uint32Array(i),s=new Uint16Array(i);(function t(r,o=0){let a=2*r,l=65535===s[a+15];if(l){let t=n[r+6],h=s[a+14];e(o,l,new Float32Array(i,4*r,6),t,h)}else{let s=n[r+6],a=n[r+7];e(o,l,new Float32Array(i,4*r,6),a)||(t(r+8,o+1),t(s,o+1))}})(0)}raycast(e,t=m.Wl3){let i=this._roots,n=this.geometry,s=[],r=t.isMaterial,o=Array.isArray(t),a=n.groups,l=r?t.side:t,h=this.indirect?ii:tY;for(let n=0,r=i.length;n<r;n++){let i=o?t[a[n].materialIndex].side:l,r=s.length;if(h(this,n,i,e,s),o){let e=a[n].materialIndex;for(let t=r,i=s.length;t<i;t++)s[t].face.materialIndex=e}}return s}raycastFirst(e,t=m.Wl3){let i=this._roots,n=this.geometry,s=t.isMaterial,r=Array.isArray(t),o=null,a=n.groups,l=s?t.side:t,h=this.indirect?io:tV;for(let n=0,s=i.length;n<s;n++){let i=r?t[a[n].materialIndex].side:l,s=h(this,n,i,e);null!=s&&(null==o||s.distance<o.distance)&&(o=s,r&&(s.face.materialIndex=a[n].materialIndex))}return o}intersectsGeometry(e,t){let i=!1,n=this._roots,s=this.indirect?ip:t2;for(let r=0,o=n.length;r<o&&!(i=s(this,r,e,t));r++);return i}shapecast(e){let t=tE.getPrimitive(),i=this.indirect?ie:tG,{boundsTraverseOrder:n,intersectsBounds:s,intersectsRange:r,intersectsTriangle:o}=e;if(r&&o){let e=r;r=(n,s,r,a,l)=>!!e(n,s,r,a,l)||i(n,s,this,o,r,a,t)}else r||(r=o?(e,n,s,r)=>i(e,n,this,o,s,r,t):(e,t,i)=>i);let h=!1,c=0,d=this._roots;for(let e=0,t=d.length;e<t;e++){let t=d[e];if(h=function(e,t,i,n,s,r){a=tM.getPrimitive(),l=tM.getPrimitive(),t_.push(a,l),tT.setBuffer(e._roots[t]);let o=function e(t,i,n,s,r=null,o=0,h=0){let{float32Array:c,uint16Array:d,uint32Array:u}=tT,p=2*t;if(tu(p,d)){let e=u[t+6],i=tp(p,d);return tt(t,c,a),s(e,i,!1,h,o+t,a)}{let p,g,y,w,x,v;let b=t+8,A=u[t+6],E=b,P=A;if(r&&(y=a,w=l,tt(E,c,y),tt(P,c,w),p=r(y),(g=r(w))<p)){E=A,P=b;let e=p;p=g,g=e,y=w}y||tt(E,c,y=a);let T=n(y,tu(2*E,d),p,h+1,o+E);if(2===T){let e=m(E);x=s(e,f(E)-e,!0,h+1,o+E,y)}else x=T&&e(E,i,n,s,r,o,h+1);if(x)return!0;tt(P,c,w=l);let _=n(w,tu(2*P,d),g,h+1,o+P);if(2===_){let e=m(P);v=s(e,f(P)-e,!0,h+1,o+P,w)}else v=_&&e(P,i,n,s,r,o,h+1);if(v)return!0;return!1;function m(e){let{uint16Array:t,uint32Array:i}=tT,n=2*e;for(;!tu(n,t);)e+=8,n=2*e;return i[e+6]}function f(e){let{uint16Array:t,uint32Array:i}=tT,n=2*e;for(;!tu(n,t);)n=2*(e=i[e+6]);return i[e+6]+tp(n,t)}}}(0,e.geometry,i,n,s,r);tT.clearBuffer(),tM.releasePrimitive(a),tM.releasePrimitive(l),t_.pop(),t_.pop();let h=t_.length;return h>0&&(l=t_[h-1],a=t_[h-2]),o}(this,e,s,r,n,c))break;c+=t.byteLength}return tE.releasePrimitive(t),h}bvhcast(e,t,i){let{intersectsRanges:n,intersectsTriangles:s}=i,r=tE.getPrimitive(),o=this.geometry.index,a=this.geometry.attributes.position,l=this.indirect?e=>{tN(r,3*this.resolveTriangleIndex(e),o,a)}:e=>{tN(r,3*e,o,a)},h=tE.getPrimitive(),c=e.geometry.index,d=e.geometry.attributes.position,u=e.indirect?t=>{tN(h,3*e.resolveTriangleIndex(t),c,d)}:e=>{tN(h,3*e,c,d)};if(s){let e=(e,i,n,o,a,c,d,p)=>{for(let m=n,f=n+o;m<f;m++){u(m),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let t=e,n=e+i;t<n;t++)if(l(t),r.needsUpdate=!0,s(r,h,t,m,a,c,d,p))return!0}return!1};if(n){let t=n;n=function(i,n,s,r,o,a,l,h){return!!t(i,n,s,r,o,a,l,h)||e(i,n,s,r,o,a,l,h)}}else n=e}return function(e,t,i,n){let s;if(iI)throw Error("MeshBVH: Recursive calls to bvhcast not supported.");iI=!0;let r=e._roots,o=t._roots,a=0,l=0,h=new m.yGw().copy(i).invert();for(let e=0,t=r.length;e<t;e++){iA.setBuffer(r[e]),l=0;let t=iP.getPrimitive();tt(0,iA.float32Array,t),t.applyMatrix4(h);for(let r=0,c=o.length;r<c&&(iE.setBuffer(o[e]),s=function e(t,i,n,s,r,o=0,a=0,l=0,h=0,c=null,d=!1){let u,p;d?(u=iE,p=iA):(u=iA,p=iE);let m=u.float32Array,f=u.uint32Array,g=u.uint16Array,y=p.float32Array,w=p.uint32Array,x=p.uint16Array,v=2*i,b=tu(2*t,g),A=tu(v,x),E=!1;if(A&&b)E=d?r(w[i+6],tp(2*i,x),f[t+6],tp(2*t,g),h,a+i,l,o+t):r(f[t+6],tp(2*t,g),w[i+6],tp(2*i,x),l,o+t,h,a+i);else if(A){let c=iP.getPrimitive();tt(i,y,c),c.applyMatrix4(n);let u=t+8,p=f[t+6];tt(u,m,iT),tt(p,m,i_);let g=c.intersectsBox(iT),w=c.intersectsBox(i_);E=g&&e(i,u,s,n,r,a,o,h,l+1,c,!d)||w&&e(i,p,s,n,r,a,o,h,l+1,c,!d),iP.releasePrimitive(c)}else{let u=i+8,p=w[i+6];tt(u,y,iM),tt(p,y,iS);let g=c.intersectsBox(iM),x=c.intersectsBox(iS);if(g&&x)E=e(t,u,n,s,r,o,a,l,h+1,c,d)||e(t,p,n,s,r,o,a,l,h+1,c,d);else if(g){if(b)E=e(t,u,n,s,r,o,a,l,h+1,c,d);else{let i=iP.getPrimitive();i.copy(iM).applyMatrix4(n);let c=t+8,p=f[t+6];tt(c,m,iT),tt(p,m,i_);let g=i.intersectsBox(iT),y=i.intersectsBox(i_);E=g&&e(u,c,s,n,r,a,o,h,l+1,i,!d)||y&&e(u,p,s,n,r,a,o,h,l+1,i,!d),iP.releasePrimitive(i)}}else if(x){if(b)E=e(t,p,n,s,r,o,a,l,h+1,c,d);else{let i=iP.getPrimitive();i.copy(iS).applyMatrix4(n);let c=t+8,u=f[t+6];tt(c,m,iT),tt(u,m,i_);let g=i.intersectsBox(iT),y=i.intersectsBox(i_);E=g&&e(p,c,s,n,r,a,o,h,l+1,i,!d)||y&&e(p,u,s,n,r,a,o,h,l+1,i,!d),iP.releasePrimitive(i)}}}return E}(0,0,i,h,n,a,l,0,0,t),iE.clearBuffer(),l+=o[r].length,!s);r++);if(iP.releasePrimitive(t),iA.clearBuffer(),a+=r[e].length,s)break}return iI=!1,s}(this,e,t,n)}intersectsBox(e,t){return iC.set(e.min,e.max,t),iC.needsUpdate=!0,this.shapecast({intersectsBounds:e=>iC.intersectsBox(e),intersectsTriangle:e=>iC.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},n={},s=0,r=1/0){return(this.indirect?function(e,t,i,n={},s={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),ig.set(t.boundingBox.min,t.boundingBox.max,i),ig.needsUpdate=!0;let a=e.geometry,l=a.attributes.position,h=a.index,c=t.attributes.position,d=t.index,u=tE.getPrimitive(),p=tE.getPrimitive(),m=null,f=null;s&&(m=iv,f=ib);let g=1/0,y=null,w=null;return(im.copy(i).invert(),iy.matrix.copy(im),e.shapecast({boundsTraverseOrder:e=>ig.distanceToBox(e),intersectsBounds:(e,t,i)=>i<g&&i<o&&(t&&(iy.min.copy(e.min),iy.max.copy(e.max),iy.needsUpdate=!0),!0),intersectsRange:(n,s)=>{if(t.boundsTree){let a=t.boundsTree;return a.shapecast({boundsTraverseOrder:e=>iy.distanceToBox(e),intersectsBounds:(e,t,i)=>i<g&&i<o,intersectsRange:(t,o)=>{for(let x=t,v=t+o;x<v;x++){tN(p,3*a.resolveTriangleIndex(x),d,c),p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let t=n,i=n+s;t<i;t++){tN(u,3*e.resolveTriangleIndex(t),h,l),u.needsUpdate=!0;let i=u.distanceToTriangle(p,iw,m);if(i<g&&(ix.copy(iw),f&&f.copy(m),g=i,y=t,w=x),i<r)return!0}}}})}{let o=e8(t);for(let t=0;t<o;t++){tN(p,3*t,d,c),p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let i=n,o=n+s;i<o;i++){tN(u,3*e.resolveTriangleIndex(i),h,l),u.needsUpdate=!0;let n=u.distanceToTriangle(p,iw,m);if(n<g&&(ix.copy(iw),f&&f.copy(m),g=n,y=i,w=t),n<r)return!0}}}}}),tE.releasePrimitive(u),tE.releasePrimitive(p),g===1/0)?null:(n.point?n.point.copy(ix):n.point=ix.clone(),n.distance=g,n.faceIndex=y,s&&(s.point?s.point.copy(f):s.point=f.clone(),s.point.applyMatrix4(im),ix.applyMatrix4(im),s.distance=ix.sub(s.point).length(),s.faceIndex=w),n)}:function(e,t,i,n={},s={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),t5.set(t.boundingBox.min,t.boundingBox.max,i),t5.needsUpdate=!0;let a=e.geometry,l=a.attributes.position,h=a.index,c=t.attributes.position,d=t.index,u=tE.getPrimitive(),p=tE.getPrimitive(),m=null,f=null;s&&(m=t7,f=t9);let g=1/0,y=null,w=null;return(t4.copy(i).invert(),t3.matrix.copy(t4),e.shapecast({boundsTraverseOrder:e=>t5.distanceToBox(e),intersectsBounds:(e,t,i)=>i<g&&i<o&&(t&&(t3.min.copy(e.min),t3.max.copy(e.max),t3.needsUpdate=!0),!0),intersectsRange:(e,n)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:e=>t3.distanceToBox(e),intersectsBounds:(e,t,i)=>i<g&&i<o,intersectsRange:(t,s)=>{for(let o=t,a=t+s;o<a;o++){tN(p,3*o,d,c),p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let t=e,i=e+n;t<i;t++){tN(u,3*t,h,l),u.needsUpdate=!0;let e=u.distanceToTriangle(p,t6,m);if(e<g&&(t8.copy(t6),f&&f.copy(m),g=e,y=t,w=o),e<r)return!0}}}});{let s=e8(t);for(let t=0;t<s;t++){tN(p,3*t,d,c),p.a.applyMatrix4(i),p.b.applyMatrix4(i),p.c.applyMatrix4(i),p.needsUpdate=!0;for(let i=e,s=e+n;i<s;i++){tN(u,3*i,h,l),u.needsUpdate=!0;let e=u.distanceToTriangle(p,t6,m);if(e<g&&(t8.copy(t6),f&&f.copy(m),g=e,y=i,w=t),e<r)return!0}}}}}),tE.releasePrimitive(u),tE.releasePrimitive(p),g===1/0)?null:(n.point?n.point.copy(t8):n.point=t8.clone(),n.distance=g,n.faceIndex=y,s&&(s.point?s.point.copy(f):s.point=f.clone(),s.point.applyMatrix4(t4),t8.applyMatrix4(t4),s.distance=t8.sub(s.point).length(),s.faceIndex=w),n)})(this,e,t,i,n,s,r)}closestPointToPoint(e,t={},i=0,n=1/0){return function(e,t,i={},n=0,s=1/0){let r=n*n,o=s*s,a=1/0,l=null;if(e.shapecast({boundsTraverseOrder:e=>(tS.copy(t).clamp(e.min,e.max),tS.distanceToSquared(t)),intersectsBounds:(e,t,i)=>i<a&&i<o,intersectsTriangle:(e,i)=>{e.closestPointToPoint(t,tS);let n=t.distanceToSquared(tS);return n<a&&(tI.copy(tS),a=n,l=i),n<r}}),a===1/0)return null;let h=Math.sqrt(a);return i.point?i.point.copy(tI):i.point=tI.clone(),i.distance=h,i.faceIndex=l,i}(this,e,t,i,n)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{tt(0,new Float32Array(t),iL),e.union(iL)}),e}}let iF=new m.zHn,iD=new m.yGw,ik=m.Kj0.prototype.raycast,iO=new m.iWj,iU=new m.Pa4,ij=new m.Pa4,iH=new m.Pa4,iN=new m.Pa4,iG=new m.Pa4,iK=new m.Pa4,iz=new m.Pa4,iX=new m.Pa4,iY=new m.Pa4,i$=new m.Pa4,iZ=new m.Pa4,iV=new m.Pa4,iQ=new m.Pa4,iW=new m.Pa4,iq=new m.yGw,iJ=new m._fP,i0=new m.Pa4;class i1{constructor(e,t,i=Number.MAX_VALUE){this.camera=e,this.scene=t,this.startPoint=new m.Pa4,this.endPoint=new m.Pa4,this.collection=[],this.instances={},this.deep=i}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(iO,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){ij.copy(e),ij.x=Math.min(e.x,t.x),ij.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),iH.setFromMatrixPosition(this.camera.matrixWorld),iN.copy(ij),iG.set(t.x,ij.y,0),iK.copy(t),iz.set(ij.x,t.y,0),iN.unproject(this.camera),iG.unproject(this.camera),iK.unproject(this.camera),iz.unproject(this.camera),iV.copy(iN).sub(iH),iQ.copy(iG).sub(iH),iW.copy(iK).sub(iH),iV.normalize(),iQ.normalize(),iW.normalize(),iV.multiplyScalar(this.deep),iQ.multiplyScalar(this.deep),iW.multiplyScalar(this.deep),iV.add(iH),iQ.add(iH),iW.add(iH);let i=iO.planes;i[0].setFromCoplanarPoints(iH,iN,iG),i[1].setFromCoplanarPoints(iH,iG,iK),i[2].setFromCoplanarPoints(iK,iz,iH),i[3].setFromCoplanarPoints(iz,iN,iH),i[4].setFromCoplanarPoints(iG,iK,iz),i[5].setFromCoplanarPoints(iW,iQ,iV),i[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){let i=Math.min(e.x,t.x),n=Math.max(e.y,t.y),s=Math.max(e.x,t.x),r=Math.min(e.y,t.y);iN.set(i,n,-1),iG.set(s,n,-1),iK.set(s,r,-1),iz.set(i,r,-1),iX.set(i,n,1),iY.set(s,n,1),i$.set(s,r,1),iZ.set(i,r,1),iN.unproject(this.camera),iG.unproject(this.camera),iK.unproject(this.camera),iz.unproject(this.camera),iX.unproject(this.camera),iY.unproject(this.camera),i$.unproject(this.camera),iZ.unproject(this.camera);let o=iO.planes;o[0].setFromCoplanarPoints(iN,iX,iY),o[1].setFromCoplanarPoints(iG,iY,i$),o[2].setFromCoplanarPoints(i$,iZ,iz),o[3].setFromCoplanarPoints(iZ,iX,iN),o[4].setFromCoplanarPoints(iG,iK,iz),o[5].setFromCoplanarPoints(i$,iY,iX),o[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,t){if(t.isMesh||t.isLine||t.isPoints){if(t.isInstancedMesh){this.instances[t.uuid]=[];for(let i=0;i<t.count;i++)t.getMatrixAt(i,iq),iq.decompose(iU,iJ,i0),iU.applyMatrix4(t.matrixWorld),e.containsPoint(iU)&&this.instances[t.uuid].push(i)}else null===t.geometry.boundingSphere&&t.geometry.computeBoundingSphere(),iU.copy(t.geometry.boundingSphere.center),iU.applyMatrix4(t.matrixWorld),e.containsPoint(iU)&&this.collection.push(t)}if(t.children.length>0)for(let i=0;i<t.children.length;i++)this.searchChildInFrustum(e,t.children[i])}}class i2{constructor(e,t){this.element=document.createElement("div"),this.element.classList.add(t),this.element.style.pointerEvents="none",this.renderer=e,this.startPoint=new m.FM8,this.pointTopLeft=new m.FM8,this.pointBottomRight=new m.FM8,this.isDown=!1,this.enabled=!0,this.onPointerDown=(function(e){!1!==this.enabled&&(this.isDown=!0,this.onSelectStart(e))}).bind(this),this.onPointerMove=(function(e){!1!==this.enabled&&this.isDown&&this.onSelectMove(e)}).bind(this),this.onPointerUp=(function(){!1!==this.enabled&&(this.isDown=!1,this.onSelectOver())}).bind(this),this.renderer.domElement.addEventListener("pointerdown",this.onPointerDown),this.renderer.domElement.addEventListener("pointermove",this.onPointerMove),this.renderer.domElement.addEventListener("pointerup",this.onPointerUp)}dispose(){this.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown),this.renderer.domElement.removeEventListener("pointermove",this.onPointerMove),this.renderer.domElement.removeEventListener("pointerup",this.onPointerUp)}onSelectStart(e){this.element.style.display="none",this.renderer.domElement.parentElement.appendChild(this.element),this.element.style.left=e.clientX+"px",this.element.style.top=e.clientY+"px",this.element.style.width="0px",this.element.style.height="0px",this.startPoint.x=e.clientX,this.startPoint.y=e.clientY}onSelectMove(e){this.element.style.display="block",this.pointBottomRight.x=Math.max(this.startPoint.x,e.clientX),this.pointBottomRight.y=Math.max(this.startPoint.y,e.clientY),this.pointTopLeft.x=Math.min(this.startPoint.x,e.clientX),this.pointTopLeft.y=Math.min(this.startPoint.y,e.clientY),this.element.style.left=this.pointTopLeft.x+"px",this.element.style.top=this.pointTopLeft.y+"px",this.element.style.width=this.pointBottomRight.x-this.pointTopLeft.x+"px",this.element.style.height=this.pointBottomRight.y-this.pointTopLeft.y+"px"}onSelectOver(){this.element.parentElement.removeChild(this.element)}}function i4(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;class i5{constructor(e,t,i,n,s,r,o,a,l){i5.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,i,n,s,r,o,a,l)}set(e,t,i,n,s,r,o,a,l){let h=this.elements;return h[0]=e,h[1]=n,h[2]=o,h[3]=t,h[4]=s,h[5]=a,h[6]=i,h[7]=r,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,n=t.elements,s=this.elements,r=i[0],o=i[3],a=i[6],l=i[1],h=i[4],c=i[7],d=i[2],u=i[5],p=i[8],m=n[0],f=n[3],g=n[6],y=n[1],w=n[4],x=n[7],v=n[2],b=n[5],A=n[8];return s[0]=r*m+o*y+a*v,s[3]=r*f+o*w+a*b,s[6]=r*g+o*x+a*A,s[1]=l*m+h*y+c*v,s[4]=l*f+h*w+c*b,s[7]=l*g+h*x+c*A,s[2]=d*m+u*y+p*v,s[5]=d*f+u*w+p*b,s[8]=d*g+u*x+p*A,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],r=e[4],o=e[5],a=e[6],l=e[7],h=e[8];return t*r*h-t*o*l-i*s*h+i*o*a+n*s*l-n*r*a}invert(){let e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],r=e[4],o=e[5],a=e[6],l=e[7],h=e[8],c=h*r-o*l,d=o*a-h*s,u=l*s-r*a,p=t*c+i*d+n*u;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let m=1/p;return e[0]=c*m,e[1]=(n*l-h*i)*m,e[2]=(o*i-n*r)*m,e[3]=d*m,e[4]=(h*t-n*a)*m,e[5]=(n*s-o*t)*m,e[6]=u*m,e[7]=(i*a-l*t)*m,e[8]=(r*t-i*s)*m,this}transpose(){let e;let t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,s,r,o){let a=Math.cos(s),l=Math.sin(s);return this.set(i*a,i*l,-i*(a*r+l*o)+r+e,-n*l,n*a,-n*(-l*r+a*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(i3.makeScale(e,t)),this}rotate(e){return this.premultiply(i3.makeRotation(-e)),this}translate(e,t){return this.premultiply(i3.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}let i3=new i5;function i6(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}class i8{static getDataURL(e){let t;if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===h&&(h=i4("canvas")),h.width=e.width,h.height=e.height;let i=h.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=h}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let t=i4("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let n=i.getImageData(0,0,e.width,e.height),s=n.data;for(let e=0;e<s.length;e++)s[e]=255*i6(s[e]/255);return i.putImageData(n,0,0),t}if(!e.data)return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e;{let t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*i6(t[e]/255)):t[e]=i6(t[e]);return{data:t,width:e.width,height:e.height}}}}let i7={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},i9={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`},ne=new m.FM8;function nt(e,t){return e.parent instanceof t?e.parent:null!==e.parent?nt(e.parent,t):null}console.log("Pallet v.0.1.0"),m.u9r.prototype.computeBoundsTree=function(e){return this.boundsTree=new iB(this,e),this.boundsTree},m.u9r.prototype.disposeBoundsTree=function(){this.boundsTree=null},m.Kj0.prototype.raycast=function(e,t){if(this.geometry.boundsTree){if(void 0===this.material)return;iD.copy(this.matrixWorld).invert(),iF.copy(e.ray).applyMatrix4(iD);let i=this.geometry.boundsTree;if(!0===e.firstHitOnly){let n=e3(i.raycastFirst(iF,this.material),this,e);n&&t.push(n)}else{let n=i.raycast(iF,this.material);for(let i=0,s=n.length;i<s;i++){let s=e3(n[i],this,e);s&&t.push(s)}}}else ik.call(this,e,t)},function(e){e.HighPerformance="high-performance",e.LowPower="low-power",e.Default="default"}(u||(u={})),function(e){e[e.Left=0]="Left",e[e.Wheel=1]="Wheel",e[e.Right=2]="Right"}(p||(p={}));class ni{constructor(){}}class nn{constructor(e){this.raycaster=new m.iMs,this.raycaster.params.Line.threshold=0}drawHelper(){}connectEvent(){}getViewportPos(e,t,i){return ne.x=e/window.innerWidth*2-1,ne.y=-(t/window.innerHeight*2)+1,i&&i.copy(ne),ne}}class ns extends nn{constructor(){super({}),this.hitPoint=new m.Pa4,this.selectionBox=new i1,this.selectionHelper=new i2(na.Get(),"selectBox"),this.selectionHelper.element.classList.add("disabled"),this.shiftPressed=!1,this.materialFolder=void 0,this.textureButton=void 0,this.targetMaterial=null,this.cursorStart=new m.FM8,this.cursorEnd=new m.FM8}drawGhost(){}connectEvent(){document.addEventListener("mousedown",e=>{this.cursorStart.set(e.clientX,e.clientY),this.shiftPressed?(d.controller.enabled=!1,this.selectionHelper.enabled=!0,this.selectionHelper.element.classList.remove("disabled"),this.selectionBox.startPoint.set(e.clientX/window.innerWidth*2-1,-(e.clientY/window.innerHeight*2)+1,.5)):this.selectionHelper.enabled=!1}),document.addEventListener("mousemove",e=>{this.shiftPressed&&this.selectionBox.endPoint.set(e.clientX/window.innerWidth*2-1,-(e.clientY/window.innerHeight*2)+1,.5)}),document.addEventListener("mouseup",e=>{this.cursorEnd.set(e.clientX,e.clientY);let t=e.target===na.Canvas(),i={drag:this.cursorStart.distanceTo(this.cursorEnd)>.01,canvasEvent:t};if(d.controller.enabled=!0,this.selectionHelper.element.classList.add("disabled"),this.disableContextGUI(),this.shiftPressed)this.selectionBox.endPoint.set(e.clientX/window.innerWidth*2-1,-(e.clientY/window.innerHeight*2)+1,.5),this.selectionBox.select(),console.log(this.selectionBox.collection.filter(e=>{let t=nt(e,e4),i=e.isTransformControlsPlane,n=e.isGround,s=e.isLine||e.isLineSegment;return!t&&!n&&!s&&!i}));else switch(e.button){case 0:this.onLeftClick(this.cursorEnd,i);break;case 2:this.onRightClick(this.cursorEnd,i);break;case 1:this.onWheelClick(this.cursorEnd,i)}}),document.addEventListener("keydown",e=>{switch(e.code){case"ControlLeft":case"AltLeft":case"Tab":break;case"ShiftLeft":this.shiftPressed=!0;break;case"KeyQ":console.log(this.controls.space),this.controls.setSpace("local"===this.controls.space?"world":"local");break;case"KeyW":this.controls.setMode("translate");break;case"KeyE":this.controls.setMode("rotate");break;case"KeyR":this.controls.setMode("scale")}}),document.addEventListener("keyup",e=>{switch(e.code){case"ControlLeft":case"AltLeft":case"Tab":break;case"ShiftLeft":this.shiftPressed=!1}})}disconnectEvent(e){}onLeftClick(e,t){if(this.controls.axis||t.drag||!t.canvasEvent)return;this.raycaster.setFromCamera(this.getViewportPos(e.x,e.y),d.camera);let i=this.raycaster.intersectObject(d.sceneGraph);this.onIntersection(i)}onRightClick(e,t){this.raycaster.setFromCamera(this.getViewportPos(e.x,e.y),d.camera);let i=this.raycaster.intersectObject(d.sceneGraph);!1==t.drag&&this.onContext(i,e)}onWheelClick(e,t){}onDragging(e){}onContext(e,t){let i=e.filter(e=>e.object.isMesh&&!nt(e.object,ek));if(i.length>0){console.log(i);let e=nt(i[0].object,m.ZAu);i[0].object.isGround?this.enableContextGUI(t,"add"):this.enableContextGUI(t,"property"),e?this.context=e:this.context=i[0].object,this.hitPoint.copy(i[0].point)}else this.context=null,this.disableContextGUI()}onIntersection(e){this.replaceButtonImage(void 0);let t=e.filter(e=>e.object.isMesh&&!nt(e.object,ek));if(console.log(t),t.length>0&&!t[0].object.isGround){this.controls.enabled=!0;let e=nt(t[0].object,m.ZAu);if(this.targetMaterial=null,e)this.controls.attach(e),this.context=e;else{let e=t[0].object;this.controls.attach(e),this.context=t[0].object,this.replaceButtonImage(void 0),e.isMesh&&e.material&&e.material.map&&(function(e){let t=i8.getDataURL(e);console.log(this),this.replaceButtonImage(t)}).bind(this)(e.material.map.image)}}else this.controls.detach(),this.controls.enabled=!1,this.controls.setMode("translate"),this.context=null}createControls(e,t){return this.controls=new ek(e,t),this.controls}enableContextGUI(e,t){this.contextGUI.style.visibility="visible",e&&(this.contextGUI.style.left=`${e.x}px`,this.contextGUI.style.top=`${e.y}px`),d.contextGUI.children.forEach(e=>{e._title.toLowerCase()==t?e.show():e.hide()})}disableContextGUI(){this.contextGUI.style.visibility="hidden"}replaceButtonImage(e){if(this.textureButton&&this.textureButton.domElement){let t=this.textureButton.domElement.children[0].children.length>1?this.textureButton.domElement.children[0].children[1]:this.textureButton.domElement.children[0].children[0];t&&(t.style.backgroundImage=`url("${e}")`,t.style.backgroundSize="cover",t.style.backgroundRepeat="no-repeat",t.style.backgroundPosition="center",t.style.width="100px",t.style.height="100px",t.style.marginLeft="auto",t.textContent="")}}replaceTexture(e){this.targetMaterial?(this.targetMaterial.map=e,this.targetMaterial.needsUpdate=!0):this.context&&(this.context.material.map=e,this.context.material.needsUpdate=!0)}}class nr{constructor(){this.array=[]}isEmpty(){return this.array.length>0}update(){this.isEmpty()}}class no{constructor(){this.root=new m.xsS,this.animationObjects=new m.ZAu}defaultScene(){}}class na{static{this.composer=null}static{this.renderer=null}static{this.canvas=null}static{this.option={alpha:!0}}static Get(){return na.renderer||na.Create({}),na.renderer}static Canvas(){return na.renderer?na.renderer.domElement:null}static Create(e){return na.renderer=new m.CP7(e),na.renderer}static AnimationLoop(e){}}class nl extends HTMLElement{constructor(){super()}}class nh{constructor(){}static FileSelector(e=!1){let t=document.createElement("input");return t.setAttribute("type","file"),t.setAttribute("multiple",`${e}`),t.click(),t}static FileExtension(e){}}class nc extends nl{constructor(e){super(),this.verticalBlurMaterial=m.jyz,this.sceneGraph=new m.xsS,this.camera=new m.cPb(75,window.innerWidth/window.innerHeight,.1,1e3),this.gltfLoader=new I,this.clock=new m.SUY,this.controller=new e_(this.camera,e),this.controller.enableDamping=!0,this.controller.dampingFactor=.1,this.updateFunctions=[],this.commandQueue=new nr;let t=na.Create({antialias:!0,canvas:e});t.setSize(window.innerWidth,window.innerHeight),t.setClearColor(3947580),t.shadowMap.enabled=!0,t.shadowMap.type=m.ntZ,t.setAnimationLoop(()=>{let e=this.clock.getDelta();this.update(e)}),window.addEventListener("resize",e=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),t.setSize(window.innerWidth,window.innerHeight)}),this.irc=new ns,this.irc.connectEvent(),this.screenGUI=new M({title:"Properties"}),this.screenGUI.close(),this.contextGUIOuter=document.createElement("div"),this.contextGUIOuter.addEventListener("mouseup",e=>e.stopPropagation());let i=this.irc;i.contextGUI=this.contextGUIOuter,document.body.appendChild(this.contextGUIOuter),this.contextGUI=new M({container:this.contextGUIOuter,title:"Context"});let n=i.createControls(this.camera,e);this.sceneGraph.add(n),n.addEventListener("dragging-changed",e=>{this.controller.enabled=!e.value}),i.selectionBox.camera=this.camera,i.selectionBox.scene=this.sceneGraph,window.addEventListener("contextmenu",e=>e.preventDefault()),this.shaderState={shadow:{blur:.2,darkness:5,opacity:1},plane:{color:"#ffffff",opacity:1},showWireframe:!1},this.shadowGroup=new m.ZAu,this.sceneGraph.add(this.shadowGroup),this.renderTarget=new m.dd2(1024,1024),this.renderTarget.generateMipmaps=!1,this.renderTargetBlur=new m.dd2(1024,1024),this.renderTargetBlur.generateMipmaps=!1;let s=new m._12(50,50).rotateX(Math.PI/2),r=new m.vBJ({map:this.renderTarget.texture,opacity:1,transparent:!0,depthWrite:!1});this.shadowPlane=new m.Kj0(s,r),this.shadowPlane.scale.y=-1,this.shadowPlane.position.set(0,.1,0),this.shadowPlane.renderOrder=1,this.shadowGroup.add(this.shadowPlane),this.shadowBlurPlane=new m.Kj0(s),this.shadowBlurPlane.visible=!1,this.shadowGroup.add(this.shadowBlurPlane),this.shadowCamera=new m.iKG(-25,25,25,-25,0,10),this.shadowCamera.rotation.x=Math.PI/2,this.shadowGroup.add(this.shadowCamera),this.shadowCameraHelper=new m.Rki(this.shadowCamera),this.shadowGroup.add(this.shadowCameraHelper),this.depthMaterial=new m.lRF,this.depthMaterial.userData.darkness={value:this.shaderState.shadow.darkness},this.depthMaterial.onBeforeCompile=(function(e){e.uniforms.darkness=this.depthMaterial.userData.darkness,e.fragmentShader=`
                uniform float darkness;
                ${e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );")}
            `}).bind(this),this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1,this.horizontalBlurMaterial=new m.jyz(i7),this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial=new m.jyz(i9),this.verticalBlurMaterial.depthTest=!1,this.createScene(),this.createGUI()}createGUI(){this.screenGUI.addFolder("System").add({Add:function(){},Import:function(){let e=nh.FileSelector();e.addEventListener("change",()=>{let t=URL.createObjectURL(e.files[0]);d.gltfLoader.load(t,e=>{d.sceneGraph.add(e.scene)})})}},"Import");let e=this.screenGUI.addFolder("Transform");e.close();let t=e.addFolder("Position");t.close();let i={X:0,Y:0,Z:0},n=e=>{f.context&&f.context.position.set(i.X,i.Y,i.Z)};t.add(i,"X").listen().onChange(n),t.add(i,"Y").listen().onChange(n),t.add(i,"Z").listen().onChange(n);let s=e.addFolder("Rotation");s.close();let r={X:0,Y:0,Z:0},o=e=>{f.context&&f.context.rotation.set(r.X,r.Y,r.Z)};s.add(r,"X").listen().onChange(o),s.add(r,"Y").listen().onChange(o),s.add(r,"Z").listen().onChange(o);let a=e.addFolder("Scale");a.close();let l={X:1,Y:1,Z:1},h=e=>{f.context&&f.context.scale.set(l.X,l.Y,l.Z)};a.add(l,"X").listen().onChange(h),a.add(l,"Y").listen().onChange(h),a.add(l,"Z").listen().onChange(h);let c=this.screenGUI.addFolder("Material"),u={Color:16777215,Map:()=>{let e=document.createElement("input");e.type="file",e.style.display="none",e.onchange=t=>{t.preventDefault(),t.stopPropagation();let i=new FileReader;i.onload=e=>{new m.dpR().load(e.target.result,e=>{console.log(f.context),f.replaceTexture(e)}),f.replaceButtonImage(e.target.result)},i.readAsDataURL(e.files[0])},e.click()},NormalMap:()=>{},SpecularMap:()=>{}};c.addColor(u,"Color").listen().onChange(e=>{f.targetMaterial?f.targetMaterial.color.setHex(e):f.context&&f.context.isMesh&&f.context.material.color&&f.context.material.color.setHex(e)});let p=c.add(u,"Map"),f=this.irc;f.textureButton=p,f.replaceButtonImage(void 0);let g=f.textureButton.domElement.children[0].children[0],y=document.createElement("div");y.textContent="Map",g.parentElement.insertBefore(y,g);let w=this.screenGUI.addFolder("Meshes"),x=this.screenGUI.addFolder("Etc"),v={Animation:!0,Loop:!0,Reset:()=>{f.context.userData.action.time=0},Updator:!0},b=x.add(v,"Animation").listen().onChange(e=>{e?f.context.userData.action.paused=!1:f.context.userData.action.paused=!0}),A=x.add(v,"Loop").listen().onChange(e=>{e?(f.context.userData.action.setLoop(m.YKA,1/0),f.context.userData.action.reset()):f.context.userData.action.setLoop(m.jAl)}),E=x.add(v,"Reset"),P=x.add(v,"Updator").listen().onChange(e=>{f.context.userData.updator.enabled=e}),T="",_=e=>{let t=e.controllers.length,i=e.controllers;e.children=[],e.controllers=[];for(let e=0;e<t;++e)i[e].hide(),i[e].destroy()};this.addUpdator(e=>{let t=f.context;if(t){if(i.X=t.position.x,i.Y=t.position.y,i.Z=t.position.z,r.X=t.rotation.x,r.Y=t.rotation.y,r.Z=t.rotation.z,l.X=t.scale.x,l.Y=t.scale.y,l.Z=t.scale.z,t.userData.mixer?(b.enable(),A.enable(),E.enable(),t.userData.action.paused&&A.setValue(t.userData.action.paused===m.YKA),t.userData.action.loop===m.YKA?A.setValue(!0):A.setValue(!1)):(b.disable(),A.disable(),E.disable()),t.userData.updator?(P.enable(),P.setValue(t.userData.updator.enabled)):P.disable(),t.isMesh&&t.material&&(t.material.color?u.Color=t.material.color.getHex():u.Color=16777215),t.uuid===T);else{T=t.uuid;let e={};_(w),t.isGroup&&t.traverse(t=>{t.isMesh&&(e[t.name]=()=>{t.material.map&&(function(e){let i=i8.getDataURL(e);f.targetMaterial=t.material,u.Color=t.material.color.getHexString(),f.replaceButtonImage(i)}).bind(this)(t.material.map.image)},w.add(e,`${t.name}`))})}}else i.X=0,i.Y=0,i.Z=0,r.X=0,r.Y=0,r.Z=0,l.X=1,l.Y=1,l.Z=1,u.Color=16777215,_(w),b.disable(),A.disable(),E.disable(),P.disable(),T=""}),this.contextGUIOuter.style.cssText="position: absolute; left: 0px; top: 0px; visibility: hidden;",this.contextGUI.addFolder("Property").hide();let M={Box:()=>{f.disableContextGUI();let e=new m.DvJ(1,1,1),t=new m.vBJ,i=new m.Kj0(e,t);i.position.copy(f.hitPoint),this.sceneGraph.add(i)},Sphere:()=>{f.disableContextGUI();let e=new m.xo$(.8,30,15),t=new m.vBJ,i=new m.Kj0(e,t);i.position.copy(f.hitPoint),this.sceneGraph.add(i)},Plane:()=>{f.disableContextGUI();let e=new m._12(1,1,1),t=new m.vBJ,i=new m.Kj0(e,t);i.position.copy(f.hitPoint),this.sceneGraph.add(i)},GLB:()=>{f.disableContextGUI()}},S=this.contextGUI.addFolder("Add");S.add(M,"Box"),S.add(M,"Sphere"),S.add(M,"Plane"),S.add(M,"GLB"),console.log(this.contextGUI)}createScene(){let e=new m.VLJ(50,50,8158332,6250335),t=new m.Kj0(new m._12(50,50,10,10),new m.vBJ({transparent:!0,opacity:.1,color:5726326}));t.name="GridPlane",t.isGround=!0,t.castShadow=!0,t.rotation.set(-1.57,0,0),this.camera.position.set(0,5,5),this.sceneGraph.add(e),this.sceneGraph.add(t),this.sceneGraph.userData.gridPlane=t,this.sceneGraph.userData.gridHelper=e,this.directionalLight=new m.Ox3(16777215,10),this.directionalLight.shadow.camera.right=25,this.directionalLight.shadow.camera.left=-25,this.directionalLight.shadow.camera.top=25,this.directionalLight.shadow.camera.bottom=-25,this.directionalLight.shadow.camera.far=10,this.directionalLight.shadow.camera.near=-50,this.directionalLight.shadow.camera.width=1024,this.directionalLight.shadow.camera.height=1024,this.sceneGraph.add(this.directionalLight),this.ambientLight=new m.Mig(16775400),this.sceneGraph.add(this.ambientLight),this.directionalLight.castShadow=!0;let i=new m.Kj0(new m.DvJ(1,1,1),new m.Wid({color:16768954}));this.sceneGraph.add(i),(c=i).receiveShadow=!0,c.castShadow=!0,c.userData.updator=this.addUpdator(e=>{i.rotation.x+=.01,i.rotation.y+=.01});let n=new m.Kj0(new m.DvJ(1,1,1),new m.Wid({color:16768954}));this.sceneGraph.add(n),n.receiveShadow=!0,n.castShadow=!0,n.position.set(1,1,.5),n.userData.updator=this.addUpdator(e=>{n.rotation.x+=.01,n.rotation.z+=.01})}clearScene(){}createEnvironment(){}loadGLTF(e,t){this.gltfLoader.load(e,e=>{t(e),this.sceneGraph.add(e.scene)})}update(e){this.updateFunctions.map(t=>{t.enabled&&t.func(e)}),this.commandQueue.update(),this.controller.update();let t=this.sceneGraph.background;this.sceneGraph.background=null,this.shadowCameraHelper.visible=!1,this.sceneGraph.userData.gridPlane.visible=!1,this.sceneGraph.userData.gridHelper.visible=!1,this.sceneGraph.overrideMaterial=this.depthMaterial;let i=!1,n=this.irc.controls;this.irc&&(i=n.visible,n.visible=!1);let s=na.Get().getClearAlpha();na.Get().setClearAlpha(0),na.Get().setRenderTarget(this.renderTarget),na.Get().render(this.sceneGraph,this.shadowCamera),this.sceneGraph.overrideMaterial=null,this.sceneGraph.userData.gridPlane.visible=!0,this.sceneGraph.userData.gridHelper.visible=!0,n.visible=i,this.blurShadow(this.shaderState.shadow.blur),this.blurShadow(.4*this.shaderState.shadow.blur),na.Get().setRenderTarget(null),na.Get().setClearAlpha(s),this.sceneGraph.background=t,na.Get().render(this.sceneGraph,this.camera)}addUpdator(e,t=!0){let i={func:e,enabled:t};return this.updateFunctions.push(i),i}appendCommand(){}blurShadow(e){this.shadowBlurPlane.visible=!0,this.shadowBlurPlane.material=this.horizontalBlurMaterial,this.shadowBlurPlane.material.uniforms.tDiffuse.value=this.renderTarget.texture,this.horizontalBlurMaterial.uniforms.h.value=1*e/256,na.Get().setRenderTarget(this.renderTargetBlur),na.Get().render(this.shadowBlurPlane,this.shadowCamera),this.shadowBlurPlane.material=this.verticalBlurMaterial,this.shadowBlurPlane.material.uniforms.tDiffuse.value=this.renderTargetBlur.texture,this.verticalBlurMaterial.uniforms.v.value=1*e/256,na.Get().setRenderTarget(this.renderTarget),na.Get().render(this.shadowBlurPlane,this.shadowCamera),this.shadowBlurPlane.visible=!1}}customElements.define("pallet-element",nl),customElements.define("pallet-engine",nc);let nd=document.getElementsByTagName("canvas");nd.length>0&&(d=new nc(nd[0]))}};